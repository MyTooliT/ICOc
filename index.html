<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>ICOc Documentation</title>
  <meta name="description" content="Tools and scripts for the ICOtronic system" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="ICOc Documentation" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Tools and scripts for the ICOtronic system" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ICOc Documentation" />
  
  <meta name="twitter:description" content="Tools and scripts for the ICOtronic system" />
  

<meta name="author" content="MyTooliT" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#icoc"><i class="fa fa-check"></i><b>1</b> ICOc</a>
<ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#requirements"><i class="fa fa-check"></i><b>1.1</b> Requirements</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path=""><a href="#hardware"><i class="fa fa-check"></i><b>1.1.1</b> Hardware</a></li>
<li class="chapter" data-level="1.1.2" data-path=""><a href="#software"><i class="fa fa-check"></i><b>1.1.2</b> Software</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#install"><i class="fa fa-check"></i><b>1.2</b> Install</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path=""><a href="#install-the-package-using-windows-terminal"><i class="fa fa-check"></i><b>1.2.1</b> Install the Package Using Windows Terminal</a></li>
<li class="chapter" data-level="1.2.2" data-path=""><a href="#troubleshooting"><i class="fa fa-check"></i><b>1.2.2</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#basic-usage"><i class="fa fa-check"></i><b>1.3</b> Basic Usage</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path=""><a href="#starting-the-program"><i class="fa fa-check"></i><b>1.3.1</b> Starting the Program</a></li>
<li class="chapter" data-level="1.3.2" data-path=""><a href="#reading-sensor-data"><i class="fa fa-check"></i><b>1.3.2</b> Reading Sensor Data</a></li>
<li class="chapter" data-level="1.3.3" data-path=""><a href="#measurement-data"><i class="fa fa-check"></i><b>1.3.3</b> Measurement Data</a></li>
<li class="chapter" data-level="1.3.4" data-path=""><a href="#changing-configuration-values"><i class="fa fa-check"></i><b>1.3.4</b> Changing Configuration Values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path=""><a href="#tutorials"><i class="fa fa-check"></i><b>2</b> Tutorials</a>
<ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#tutorials:section:sth-renaming"><i class="fa fa-check"></i><b>2.1</b> Sensor Device Renaming</a></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#command-line-usage-of-icoc"><i class="fa fa-check"></i><b>2.2</b> Command Line Usage of ICOc</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path=""><a href="#tutorials:section:available-options"><i class="fa fa-check"></i><b>2.2.1</b> Available Options</a></li>
<li class="chapter" data-level="2.2.2" data-path=""><a href="#channel-selection"><i class="fa fa-check"></i><b>2.2.2</b> Channel Selection</a></li>
<li class="chapter" data-level="2.2.3" data-path=""><a href="#changing-the-run-time"><i class="fa fa-check"></i><b>2.2.3</b> Changing the Run Time</a></li>
<li class="chapter" data-level="2.2.4" data-path=""><a href="#start-the-measurement"><i class="fa fa-check"></i><b>2.2.4</b> Start the Measurement</a></li>
<li class="chapter" data-level="2.2.5" data-path=""><a href="#changing-the-logging-level"><i class="fa fa-check"></i><b>2.2.5</b> Changing the Logging Level</a></li>
<li class="chapter" data-level="2.2.6" data-path=""><a href="#changing-the-reference-voltage"><i class="fa fa-check"></i><b>2.2.6</b> Changing the Reference Voltage</a></li>
<li class="chapter" data-level="2.2.7" data-path=""><a href="#changing-the-sampling-rate"><i class="fa fa-check"></i><b>2.2.7</b> Changing the Sampling Rate</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path=""><a href="#icon-cli-tool"><i class="fa fa-check"></i><b>2.3</b> ICOn CLI Tool</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path=""><a href="#listing-available-sensor-devices"><i class="fa fa-check"></i><b>2.3.1</b> Listing Available Sensor Devices</a></li>
<li class="chapter" data-level="2.3.2" data-path=""><a href="#collecting-measurement-data"><i class="fa fa-check"></i><b>2.3.2</b> Collecting Measurement Data</a></li>
<li class="chapter" data-level="2.3.3" data-path=""><a href="#renaming-a-sensor-device"><i class="fa fa-check"></i><b>2.3.3</b> Renaming a Sensor Device</a></li>
<li class="chapter" data-level="2.3.4" data-path=""><a href="#opening-the-user-configuration"><i class="fa fa-check"></i><b>2.3.4</b> Opening the User Configuration</a></li>
<li class="chapter" data-level="2.3.5" data-path=""><a href="#stu-commands"><i class="fa fa-check"></i><b>2.3.5</b> STU Commands</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path=""><a href="#production-tests"><i class="fa fa-check"></i><b>2.4</b> Production Tests</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path=""><a href="#tutorials:section:general"><i class="fa fa-check"></i><b>2.4.1</b> General</a></li>
<li class="chapter" data-level="2.4.2" data-path=""><a href="#tutorials:section:sth"><i class="fa fa-check"></i><b>2.4.2</b> STH</a></li>
<li class="chapter" data-level="2.4.3" data-path=""><a href="#tutorials:section:smh"><i class="fa fa-check"></i><b>2.4.3</b> SMH</a></li>
<li class="chapter" data-level="2.4.4" data-path=""><a href="#tutorials:section:stu"><i class="fa fa-check"></i><b>2.4.4</b> STU</a></li>
<li class="chapter" data-level="2.4.5" data-path=""><a href="#firmware-versions"><i class="fa fa-check"></i><b>2.4.5</b> Firmware Versions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path=""><a href="#verification-tests"><i class="fa fa-check"></i><b>2.5</b> Verification Tests</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path=""><a href="#preparation"><i class="fa fa-check"></i><b>2.5.1</b> Preparation</a></li>
<li class="chapter" data-level="2.5.2" data-path=""><a href="#execution"><i class="fa fa-check"></i><b>2.5.2</b> Execution</a></li>
<li class="chapter" data-level="2.5.3" data-path=""><a href="#problematic-tests"><i class="fa fa-check"></i><b>2.5.3</b> Problematic Tests</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#code-examples"><i class="fa fa-check"></i><b>3</b> Code Examples</a></li>
<li class="chapter" data-level="4" data-path=""><a href="#virtualization"><i class="fa fa-check"></i><b>4</b> Virtualization</a>
<ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#windows-subsystem-for-linux-2"><i class="fa fa-check"></i><b>4.1</b> Windows Subsystem for Linux 2</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path=""><a href="#installingusing-simplicity-commander"><i class="fa fa-check"></i><b>4.1.1</b> Installing/Using Simplicity Commander</a></li>
<li class="chapter" data-level="4.1.2" data-path=""><a href="#run-tests-in-wsl"><i class="fa fa-check"></i><b>4.1.2</b> Run Tests in WSL</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path=""><a href="#containerization"><i class="fa fa-check"></i><b>5</b> Containerization</a>
<ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#docker-on-linux"><i class="fa fa-check"></i><b>5.1</b> Docker on Linux</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path=""><a href="#creating-a-docker-image"><i class="fa fa-check"></i><b>5.1.1</b> Creating a Docker Image</a></li>
<li class="chapter" data-level="5.1.2" data-path=""><a href="#building-the-docker-image"><i class="fa fa-check"></i><b>5.1.2</b> Building the Docker Image</a></li>
<li class="chapter" data-level="5.1.3" data-path=""><a href="#using-icoc-in-the-docker-container"><i class="fa fa-check"></i><b>5.1.3</b> Using ICOc in the Docker Container</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path=""><a href="#scripts:section:scripts"><i class="fa fa-check"></i><b>6</b> Scripts</a>
<ul>
<li class="chapter" data-level="6.1" data-path=""><a href="#eeprom-check"><i class="fa fa-check"></i><b>6.1</b> EEPROM Check</a></li>
<li class="chapter" data-level="6.2" data-path=""><a href="#section:scripts:icoc"><i class="fa fa-check"></i><b>6.2</b> ICOc</a></li>
<li class="chapter" data-level="6.3" data-path=""><a href="#section:scripts:icon"><i class="fa fa-check"></i><b>6.3</b> ICOn</a></li>
<li class="chapter" data-level="6.4" data-path=""><a href="#mac-address-conversion"><i class="fa fa-check"></i><b>6.4</b> MAC Address Conversion</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path=""><a href="#examples"><i class="fa fa-check"></i><b>6.4.1</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path=""><a href="#section:scripts:test-sth"><i class="fa fa-check"></i><b>6.5</b> Test-STH</a></li>
<li class="chapter" data-level="6.6" data-path=""><a href="#section:scripts:test-stu"><i class="fa fa-check"></i><b>6.6</b> Test-STU</a></li>
<li class="chapter" data-level="6.7" data-path=""><a href="#section:scripts:test-smh"><i class="fa fa-check"></i><b>6.7</b> Test-SMH</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path=""><a href="#development"><i class="fa fa-check"></i><b>7</b> Development</a>
<ul>
<li class="chapter" data-level="7.1" data-path=""><a href="#install-1"><i class="fa fa-check"></i><b>7.1</b> Install</a></li>
<li class="chapter" data-level="7.2" data-path=""><a href="#style"><i class="fa fa-check"></i><b>7.2</b> Style</a></li>
<li class="chapter" data-level="7.3" data-path=""><a href="#tests"><i class="fa fa-check"></i><b>7.3</b> Tests</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path=""><a href="#code-checks"><i class="fa fa-check"></i><b>7.3.1</b> Code Checks</a></li>
<li class="chapter" data-level="7.3.2" data-path=""><a href="#automatic-tests"><i class="fa fa-check"></i><b>7.3.2</b> Automatic Tests</a></li>
<li class="chapter" data-level="7.3.3" data-path=""><a href="#manual-tests"><i class="fa fa-check"></i><b>7.3.3</b> Manual Tests</a></li>
<li class="chapter" data-level="7.3.4" data-path=""><a href="#combined-checks-tests"><i class="fa fa-check"></i><b>7.3.4</b> Combined Checks &amp; Tests</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path=""><a href="#development:section:release"><i class="fa fa-check"></i><b>7.4</b> Release</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ICOc Documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">ICOc Documentation</h1>
<p class="author"><em>MyTooliT</em></p>
</div>
<div id="icoc" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> ICOc<a href="#icoc" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>ICOc is a</p>
<ul>
<li><a href="https://pypi.org/project/icoc">Python library</a> and</li>
<li>collection of tools and scripts</li>
</ul>
<p>for the <a href="https://www.mytoolit.com/ICOtronic/">ICOtronic system</a>. Currently the main purpose of the software is:</p>
<ul>
<li><strong>Data Collection</strong> via
<ul>
<li>the script <a href="#command-line-usage-of-icoc"><code>icoc</code></a> (Windows only) or</li>
<li>the script <a href="#icon-cli-tool"><code>icon</code></a> (Linux, macOS, Windows) or</li>
<li>directly <a href="https://icoc.readthedocs.io">via the API</a> (Linux, macOS, Windows)</li>
</ul></li>
<li><strong>Testing</strong> the functionality of
<ul>
<li><a href="#tutorials:section:stu">Stationary Transceiver Unit (STU)</a> and</li>
<li>sensor devices/nodes, such as
<ul>
<li><a href="#tutorials:section:sth">Sensory Holder Assembly (SHA)/Sensory Tool Holder (STH)</a></li>
<li><a href="#tutorials:section:stu">Sensory Milling Head (SMH)</a></li>
</ul></li>
</ul></li>
</ul>
<p>The software reads data from the Stationary Transceiver Unit (STU) via CAN using the <a href="https://mytoolit.github.io/Documentation/#mytoolit-communication-protocol">MyTooliT protocol</a>. The STU itself reads from and writes data to the sensor devices via Bluetooth.</p>
<p><strong>Notes</strong>:</p>
<ul>
<li><p>The command line tool <a href="#command-line-usage-of-icoc"><code>icoc</code></a> requires <a href="https://microsoft.com/windows">Microsoft Windows 10</a> (tested) or Windows 11 (untested).</p></li>
<li><p>The</p>
<ul>
<li>test suite (except for the <a href="#verification-tests">deprecated verification tests</a>),</li>
<li><a href="#icon-cli-tool"><code>icon</code></a>, and</li>
<li>the (new) <a href="https://icoc.readthedocs.io">API</a></li>
</ul>
<p>use <a href="https://python-can.readthedocs.io">python-can</a> and therefore also works on Linux and macOS. The <a href="#command-line-usage-of-icoc">ICOc measurement tool</a> does <a href="https://github.com/MyTooliT/ICOc/issues/4"><strong>not</strong></a>. For more information on how to use (parts of) the ICOc software on Linux, please take a look <a href="#introduction:section:pcan-driver:linux">here</a>.</p></li>
</ul>
<p>For more information about other required software components, please read the subsection <a href="#software">“Software”</a> in this document.</p>
<div id="requirements" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Requirements<a href="#requirements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hardware" class="section level3 hasAnchor" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Hardware<a href="#hardware" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to use ICOc you need at least:</p>
<ul>
<li><p>a <a href="https://www.peak-system.com">PCAN adapter</a>:</p>
<p><img src="Documentation/Pictures/PCAN.jpg" alt="PCAN Adapter" /></p>
<p>including:</p>
<ul>
<li><p>power injector, and</p></li>
<li><p>power supply unit (for the power injector):</p>
<p><img src="Documentation/Pictures/Power-Injector.jpg" alt="Power Injector" /></p></li>
</ul></li>
<li><p>a <a href="https://www.mytoolit.com/ICOtronic/">Stationary Transceiver Unit</a>:</p>
<p><img src="https://cdn.bitrix24.de/b5488381/landing/5fa/5fa2ce04fd1326e07bf39866e44f4e61/IMG_6338_2x.jpg" alt="STU" width="400"></p></li>
<li><p>a sensor device, such as a <a href="https://www.mytoolit.com/ICOtronic/">Sensory Tool Holder</a>:
<img src="https://cdn.bitrix24.de/b5488381/landing/cbe/cbe07df56cea688299533819c1e8a8d3/IMG_6350_2x_2x.jpg" alt="Sensory Tool Holder" width="400"></p></li>
</ul>
<div id="setup" class="section level4 hasAnchor" number="1.1.1.1">
<h4><span class="header-section-number">1.1.1.1</span> Setup<a href="#setup" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Connect the power injector
<ol style="list-style-type: decimal">
<li>to the PCAN adapter, and</li>
<li>the power supply unit.</li>
</ol></li>
<li>Connect the USB connector of the PCAN adapter to your computer.</li>
<li>Make sure that your sensor device (SHA/STH/SMH) is connected to a power source. For an STH this usually means that you should check that the battery is (fully) charged.</li>
</ol>
</div>
</div>
<div id="software" class="section level3 hasAnchor" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Software<a href="#software" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="python" class="section level4 hasAnchor" number="1.1.2.1">
<h4><span class="header-section-number">1.1.2.1</span> Python<a href="#python" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>ICOc requires at least Python <code>3.9</code>. The software also supports Python <code>3.10</code>, <code>3.11</code> and <code>3.12</code>. We recommend you use the 64-bit version of Python.</p>
<p>You can download Python <a href="https://www.python.org/downloads">here</a>. When you install the software, please do not forget to enable the checkbox <strong>“Add Python to PATH”</strong> in the setup window of the installer.</p>
</div>
<div id="pcan-driver" class="section level4 hasAnchor" number="1.1.2.2">
<h4><span class="header-section-number">1.1.2.2</span> PCAN Driver<a href="#pcan-driver" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To communicate with the STU you need a driver that works with the PCAN adapter. The text below describes how to install/enable this driver on</p>
<ul>
<li><a href="#introduction:section:pcan-driver:linux">Linux</a>,</li>
<li><a href="#introduction:section:pcan-driver:macos">macOS</a>, and</li>
<li><a href="#introduction:section:pcan-driver:windows">Windows</a>.</li>
</ul>
<div id="introduction:section:pcan-driver:linux" class="section level5 hasAnchor" number="1.1.2.2.1">
<h5><span class="header-section-number">1.1.2.2.1</span> Linux<a href="#introduction:section:pcan-driver:linux" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>You need to make sure that your CAN adapter is available via the <a href="https://en.wikipedia.org/wiki/SocketCAN">SocketCAN</a> interface.</p>
<p>The following steps describe one possible option to configure the CAN interface on (<a href="https://getfedora.org">Fedora</a>, <a href="https://ubuntu.com">Ubuntu</a>) Linux <strong>manually</strong>.</p>
<ol style="list-style-type: decimal">
<li><p>Connect the CAN adapter to the computer that runs Linux (or alternatively the Linux VM)</p></li>
<li><p>Check the list of available interfaces:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">networkctl</span> list</span></code></pre></div>
<p>The command output should list the CAN interface with the name <code>can0</code></p></li>
<li><p>Configure the CAN interface with the following command:</p>
<pre><code>sudo ip link set can0 type can bitrate 1000000</code></pre></li>
<li><p>Bring up the CAN interface</p>
<pre><code>sudo ip link set can0 up</code></pre></li>
</ol>
<p>You can also configure the CAN interface <strong>automatically</strong>. For that purpose please store the following text:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">[Match]</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="dt">Name</span><span class="ot">=</span><span class="st">can*</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="kw">[CAN]</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="dt">BitRate</span><span class="ot">=</span><span class="dv">1000000</span></span></code></pre></div>
<p>in a file called <code>/etc/systemd/network/can.network</code>. Afterwards enable <code>networkd</code> and reload the configuration with the commands:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable systemd-networkd</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart systemd-networkd</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co"># Note: The command `networkctl reload` only works in systemd 244 or newer</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="fu">sudo</span> networkctl reload <span class="kw">||</span> <span class="fu">sudo</span> systemctl reload systemd-networkd</span></code></pre></div>
<p>You can check the status of the CAN connection with the command:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">networkctl</span> list</span></code></pre></div>
<p>If everything works as expected, then the output of the command should look similar to the text below:</p>
<pre><code>IDX LINK   TYPE     OPERATIONAL SETUP
  …
  7 can0   can      carrier     configured</code></pre>
<p><strong>Sources</strong>:</p>
<ul>
<li><a href="https://askubuntu.com/questions/1082277/socketcan-device-on-ubuntu-core">SocketCAN device on Ubuntu Core</a></li>
<li><a href="https://github.com/linux-can/can-utils/issues/68#issuecomment-584505426">Question: How can I automatically bring up CAN interface using netplan?</a></li>
<li><a href="https://wiki.ubuntuusers.de/systemd/networkd/">networkd › systemd › Wiki › ubuntuusers</a></li>
</ul>
</div>
<div id="introduction:section:pcan-driver:macos" class="section level5 hasAnchor" number="1.1.2.2.2">
<h5><span class="header-section-number">1.1.2.2.2</span> macOS<a href="#introduction:section:pcan-driver:macos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>On macOS you can use the <a href="https://github.com/mac-can/PCBUSB-Library">PCBUSB</a> library to add support for the PCAN adapter. For more information on how to install this library please take a look <a href="https://github.com/mac-can/PCBUSB-Library/issues/10#issuecomment-1188682027">here</a>.</p>
</div>
<div id="introduction:section:pcan-driver:windows" class="section level5 hasAnchor" number="1.1.2.2.3">
<h5><span class="header-section-number">1.1.2.2.3</span> Windows<a href="#introduction:section:pcan-driver:windows" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>You can find the download link for the PCAN Windows driver <a href="https://www.peak-system.com/quick/DrvSetup">here</a>. Please make sure that you include the “PCAN-Basic API” when you install the software.</p>
</div>
</div>
<div id="simplicity-commander-optional" class="section level4 hasAnchor" number="1.1.2.3">
<h4><span class="header-section-number">1.1.2.3</span> Simplicity Commander (Optional)<a href="#simplicity-commander-optional" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the tests that require a firmware flash you need to <strong>either</strong> install</p>
<ul>
<li><a href="https://www.silabs.com/products/development-tools/software/simplicity-studio">Simplicity Studio</a> or</li>
<li><a href="https://www.silabs.com/developers/mcu-programming-options">Simplicity Commander</a>.</li>
</ul>
<p>If you choose the first option, then please make sure to install the Simplicity Commander tool inside Simplicity Studio.</p>
<div id="linux" class="section level5 hasAnchor" number="1.1.2.3.1">
<h5><span class="header-section-number">1.1.2.3.1</span> Linux<a href="#linux" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Please add the path to <code>commander</code> to the list <code>commands</code> → <code>path</code> → <code>linux</code> in the <a href="#changing-configuration-values">configuration</a>.</p>
</div>
<div id="macos" class="section level5 hasAnchor" number="1.1.2.3.2">
<h5><span class="header-section-number">1.1.2.3.2</span> macOS<a href="#macos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>If you install Simplicity Studio or Simplicity Commander in the standard install path (<code>/Applications</code>) you do not need to change the config. If you put the application in a different directory, then please add the path to <code>commander</code> to the list <code>commands</code> → <code>path</code> → <code>mac</code> in the <a href="#changing-configuration-values">configuration</a>.</p>
</div>
<div id="windows" class="section level5 hasAnchor" number="1.1.2.3.3">
<h5><span class="header-section-number">1.1.2.3.3</span> Windows<a href="#windows" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li><p>If you installed Simplicity Studio (including Simplicity Studio) to the standard location, then you do not need to change the configuration.</p></li>
<li><p>If you download Simplicity Commander directly, then the tests assume that you unzipped the files into the directory <code>C:\SiliconLabs\Simplicity Commander</code>.</p></li>
<li><p>If you did not use any of the standard install path, then please add the path to <code>commander.exe</code> to the list <code>commands</code> → <code>path</code> → <code>windows</code> in the <a href="#changing-configuration-values">configuration</a>.</p></li>
</ul>
</div>
<div id="additional-notes" class="section level5 hasAnchor" number="1.1.2.3.4">
<h5><span class="header-section-number">1.1.2.3.4</span> Additional Notes<a href="#additional-notes" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>If you <strong>do not want to change the config</strong>, and Simplicity Commander (<code>commander</code>) is not part of the standard locations for your operating system, then please make sure that <code>commander</code> is accessible via the <code>PATH</code> environment variable.</li>
<li>Please note, that you <strong>do not need to install Simplicity Commander</strong> if you just want to <strong>measure data with ICOc</strong>.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="install" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Install<a href="#install" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Please use the following command:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">pip</span> install icoc</span></code></pre></div>
<p>to install the <a href="https://pypi.org/project/icoc">latest official version of ICOc from PyPi</a>. Afterwards you can use the various <a href="#scripts:section:scripts">scripts</a> included in the package.</p>
<div id="install-the-package-using-windows-terminal" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Install the Package Using Windows Terminal<a href="#install-the-package-using-windows-terminal" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Install (Windows) <a href="https://aka.ms/terminal">Terminal</a> if you have not done so already; On Windows 11 this application should be installed by default.</p></li>
<li><p>Open Terminal</p></li>
<li><p>Copy and paste the following text into the Terminal</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">pip</span> install icoc</span></code></pre></div></li>
<li><p>Press Return <kbd>⏎</kbd></p></li>
<li><p>Wait until the install process finished successfully</p></li>
</ol>
</div>
<div id="troubleshooting" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Troubleshooting<a href="#troubleshooting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="import-errors" class="section level4 hasAnchor" number="1.2.2.1">
<h4><span class="header-section-number">1.2.2.1</span> Import Errors<a href="#import-errors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If one of the tests or ICOc fails with an error message that looks similar to the following text:</p>
<pre><code>Traceback (most recent call last):
…
    from numexpr.interpreter import MAX_THREADS, use_vml, __BLOCK_SIZE1__
ImportError: DLL load failed while importing interpreter: The specified module could not be found.

DLL load failed while importing interpreter: The specified module could not be found.</code></pre>
<p>then you probably need to install the <a href="https://docs.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist">“Microsoft Visual C++ Redistributable package”</a>. You can download the latest version</p>
<ul>
<li>for the <code>x64</code> architecture, i.e. for AMD and Intel CPUs, <a href="https://aka.ms/vs/17/release/vc_redist.x64.exe">here</a> and</li>
<li>for the <code>ARM64</code> architecture <a href="https://aka.ms/vs/17/release/vc_redist.arm64.exe">here</a>.</li>
</ul>
</div>
<div id="insufficient-rights" class="section level4 hasAnchor" number="1.2.2.2">
<h4><span class="header-section-number">1.2.2.2</span> Insufficient Rights<a href="#insufficient-rights" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>If you do not have sufficient rights</strong> to install the package you can also try to install the package in the user package folder:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--user</span> icoc</span></code></pre></div>
</div>
<div id="unable-to-install-in-editable-mode" class="section level4 hasAnchor" number="1.2.2.3">
<h4><span class="header-section-number">1.2.2.3</span> Unable to Install in Editable Mode<a href="#unable-to-install-in-editable-mode" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If the ICOc install fails with the following error:</p>
<pre><code>ERROR: Project …/ICOc has a &#39;pyproject.toml&#39; and its build backend is missing the &#39;build_editable&#39; hook.
Since it does not have a &#39;setup.py&#39; nor a &#39;setup.cfg&#39;, it cannot be installed in editable mode.
Consider using a build backend that supports PEP 660.</code></pre>
<p>then your version of <a href="http://setuptools.pypa.io">Setuptools</a> needs to be updated before you install ICOc. You can use the following command to do that:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-U</span> pip setuptools</span></code></pre></div>
</div>
<div id="introduction:section:unable-to-locate-hdf5" class="section level4 hasAnchor" number="1.2.2.4">
<h4><span class="header-section-number">1.2.2.4</span> Unable to Locate HDF5<a href="#introduction:section:unable-to-locate-hdf5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The installation of ICOc might fail with an error message that looks like this:</p>
<pre><code>… implicit declaration of function &#39;H5close&#39;</code></pre>
<p>If you uses <a href="https://brew.sh">Homebrew</a> on an Apple Silicon based Mac you can use the <a href="https://stackoverflow.com/questions/73029883/could-not-find-hdf5-installation-for-pytables-on-m1-mac">following commands to fix this problem</a>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">pip</span> uninstall <span class="at">-y</span> tables</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="ex">brew</span> install hdf5 c-blosc2 lzo bzip2</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="bu">export</span> <span class="va">BLOSC_DIR</span><span class="op">=</span>/opt/homebrew/opt/c-blosc</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="bu">export</span> <span class="va">BZIP2_DIR</span><span class="op">=</span>/opt/homebrew/opt/bzip2</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="bu">export</span> <span class="va">LZO_DIR</span><span class="op">=</span>/opt/homebrew/opt/lzo</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="bu">export</span> <span class="va">HDF5_DIR</span><span class="op">=</span>/opt/homebrew/opt/hdf5</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># Require version 3.9.1, since 3.9.2 might fail because of an</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co"># “Illegal instruction” error:</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co"># https://github.com/PyTables/PyTables/issues/1093</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--no-cache-dir</span> tables==3.9.1</span></code></pre></div>
</div>
<div id="hdf5-library-not-loaded" class="section level4 hasAnchor" number="1.2.2.5">
<h4><span class="header-section-number">1.2.2.5</span> HDF5 Library Not Loaded<a href="#hdf5-library-not-loaded" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Some of the ICOc commands might fail with an error message that looks like this on macOS:</p>
<blockquote>
<p><code>Library not loaded: /opt/homebrew/opt/hdf5/lib/libhdf5.….dylib</code></p>
</blockquote>
<p>In that case you might have installed an outdated cached version of <a href="https://www.pytables.org">PyTables</a>. You should be able to fix this issue using the same steps as described <a href="#introduction:section:unable-to-locate-hdf5">above</a>.</p>
</div>
<div id="unable-to-open-openblas-library" class="section level4 hasAnchor" number="1.2.2.6">
<h4><span class="header-section-number">1.2.2.6</span> Unable to open OpenBLAS library<a href="#unable-to-open-openblas-library" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If one of the ICOc command fails with the error message:</p>
<blockquote>
<p>ImportError: libopenblas.so.0: cannot open shared object file: No such file or directory</p>
</blockquote>
<p>on <a href="http://www.raspbian.org">Raspbian</a> (or some other GNU/Linux version based on Debian) then you probably need to install the <a href="http://www.openblas.net">OpenBLAS</a> library:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">sudo</span> apt-get install libopenblas-dev</span></code></pre></div>
</div>
<div id="unknown-command-icoc" class="section level4 hasAnchor" number="1.2.2.7">
<h4><span class="header-section-number">1.2.2.7</span> Unknown Command <code>icoc</code><a href="#unknown-command-icoc" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If <code>pip install</code> prints <strong>warnings about the path</strong> that look like this:</p>
<blockquote>
<p>The script … is installed in <code>'…\Scripts'</code> which is not on PATH.</p>
</blockquote>
<p>then please add the text between the single quotes (without the quotes) to your <a href="https://helpdeskgeek.com/windows-10/add-windows-path-environment-variable/">PATH environment variable</a>. Here <code>…\Scripts</code> is just a placeholder. Please use the value that <code>pip install</code> prints on your machine. If</p>
<ul>
<li>you used the <a href="https://www.python.org/downloads">installer from the Python website</a> (and checked “Add Python to PATH”) or</li>
<li>you used <a href="https://docs.microsoft.com/en-us/windows/package-manager/winget/">winget</a></li>
</ul>
<p>to install Python, then the warning above should not appear. On the other hand, the <strong>Python version from the <a href="https://www.microsoft.com/en-us/store/apps/windows">Microsoft Store</a> might not add the <code>Scripts</code> directory</strong> to your path.</p>
</div>
</div>
</div>
<div id="basic-usage" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Basic Usage<a href="#basic-usage" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="starting-the-program" class="section level3 hasAnchor" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Starting the Program<a href="#starting-the-program" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>ICOc</code> script can be used to control a sensor device. After you enter the command</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">icoc</span></span></code></pre></div>
<p>in your <a href="https://aka.ms/terminal">terminal</a>, a text based interface shows you the currently available options. For example, the text</p>
<pre><code>                ICOc

       Name      Address            RSSI
———————————————————————————————————————————————
    1: Blubb     08:6b:d7:01:de:81  -44 dBm

┌──────────────────────────────┐
│ 1-9: Connect to STH          │
│                              │
│   f: Change Output File Name │
│   n: Change STH Name         │
│                              │
│   q: Quit ICOc               │
└──────────────────────────────┘</code></pre>
<p>shows that currently one sensor device was detected. The</p>
<ul>
<li>Bluetooth MAC address of the device is <code>08:6b:d7:01:de:81</code>, while its</li>
<li>advertisement name is “Blubb”.</li>
</ul>
<p>The last value “-44” is the current <a href="https://en.wikipedia.org/wiki/Received_signal_strength_indication">received signal strength indication (RSSI)</a>. To exit the program use the key <kbd>q</kbd>.</p>
</div>
<div id="reading-sensor-data" class="section level3 hasAnchor" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Reading Sensor Data<a href="#reading-sensor-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To read data from an STH (or SHA), start the ICOc script, and connect to an STH. To do that, enter the number in front of an STH entry (e.g. <code>1</code> for the first detected STH) and use the return key <kbd>⮐</kbd> to confirm your selection. The text based interface will now show you something like this:</p>
<pre><code>                ICOc
STH “Blubb” (08:6b:d7:01:de:81)
———————————————————————————————

Hardware Version      1.4.0
Firmware Version      2.1.10
Firmware Release Name Tanja
Serial Number         –

Supply Voltage        3.16 V
Chip Temperature      26.2 °C

Run Time              ∞ s

Prescaler             2
Acquisition Time      8
Oversampling Rate     64
⇒ Sampling Rate       9524
Reference Voltage     VDD

Sensors               M1: S1

┌───────────────────────────┐
│ s: Start Data Acquisition │
│                           │
│ n: Change STH Name        │
│ r: Change Run Time        │
│ a: Configure ADC          │
│ p: Configure Sensors      │
│ O: Set Standby Mode       │
│                           │
│ q: Disconnect from STH    │
└───────────────────────────┘</code></pre>
<p>To start the data acquisition press the key <kbd>s</kbd>. Afterwards a graphical window</p>
<p><img src="Documentation/Pictures/Measurement.png" alt="Measurement" /></p>
<p>will show the sensor data. To stop the data acquisition, click the close button on the top of the graph. For more information on how to use ICOc and the test suite, please take a look at the <a href="#tutorials">section “Tutorials”</a>.</p>
</div>
<div id="measurement-data" class="section level3 hasAnchor" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Measurement Data<a href="#measurement-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<hr />
<p><strong>Note:</strong> ICOc <strong>assumes</strong> that the sensor device always measures <strong>acceleration data</strong> in multiples of the <a href="https://en.wikipedia.org/wiki/Gravity_of_Earth">gravity of earth</a>, commonly referred as <span class="math inline">\(g\)</span> or <span class="math inline">\(g_0\)</span>. While this is true for most of the sensor hardware (such as STHs), some sensor devices measure other values, e.g. force or temperature. Even in this case the measurement software will (incorrectly) <a href="https://github.com/MyTooliT/ICOc/blob/dc636ce2cda8f380aa0f031fc743062820eb3443/mytoolit/measurement/acceleration.py#L50-L51">convert the data into multiples of <span class="math inline">\(g\)</span></a>. We are <strong>working on adding support for configuring the sensor type</strong> in the firmware and ICOc to <strong>fix this issue</strong>.</p>
<hr />
<p>The ICOc script stores measured acceleration values in <a href="https://www.hdfgroup.org/solutions/hdf5/">HDF5</a> files. By default these files will be stored in the root of the repository with</p>
<ul>
<li>a name starting with the text <code>Measurement</code></li>
<li>followed by a date/time-stamp,</li>
<li>and the extension <code>.hdf5</code>.</li>
</ul>
<p>To take a look at the measurement data you can use the tool <a href="https://www.hdfgroup.org/downloads/hdfview/">HDFView</a>. Unfortunately you need to create a free account to download the program. If you do not want to register, then you can try if <a href="http://bugmenot.com/view/hdfgroup.org">one of the accounts listed at BugMeNot</a> works. Another option is to download the application from <a href="https://support.hdfgroup.org/ftp/HDF5/releases/HDF-JAVA/">here</a>. Just click on the folder for the latest version of the application (<code>hdfview-…</code>) and afterwards on the folder <code>bin</code> to see a list of compressed binaries (<code>.zip</code> &amp; <code>.tar.gz</code>) for the different supported operating systems.</p>
<p>The screenshot below shows a measurement file produced by ICOc:</p>
<p><img src="Documentation/Pictures/HDFView-File.png" alt="Main Window of HDFView" /></p>
<p>As you can see the table with the name <code>acceleration</code> stores the acceleration data. The screenshot above displays the metadata of the table. The most important meta attributes here are probably:</p>
<ul>
<li><code>Start_Time</code>, which contains the start time of the measurement run in ISO format, and</li>
<li><code>Sensor_Range</code>, which specifies the range of the used acceleration sensor in multiples of earth’s gravitation (g₀ ≅ 9.81 m/s²).</li>
</ul>
<p>After you double click on the acceleration table on the left, HDFView will show you the actual acceleration data:</p>
<p><img src="Documentation/Pictures/HDFView-Table.png" alt="Acceleration Table in HDFView" width="500"/></p>
<p>As you can infer from the <code>x</code> column above the table shows the acceleration measurement data (in multiples of g₀) for a single axis. The table below describes the meaning of the columns:</p>
<table>
<colgroup>
<col width="7%" />
<col width="77%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>counter</td>
<td>A cyclic counter value (0–255) sent with the acceleration data to recognize lost packets</td>
<td>–</td>
</tr>
<tr class="even">
<td>timestamp</td>
<td>The timestamp for the measured value in microseconds since the measurement start</td>
<td>μs</td>
</tr>
<tr class="odd">
<td>x</td>
<td>Acceleration in the x direction as multiples of earth’s gravitation</td>
<td>g₀ (≅ 9.81 m/s²)</td>
</tr>
</tbody>
</table>
<p>Depending on your sensor and your settings the table might also contain columns for the <code>y</code> and/or <code>z</code> axis.</p>
<p>If you want you can also use HDFView to print a simple graph for your acceleration data. To do that:</p>
<ol style="list-style-type: decimal">
<li>Select the values for the the ordinate (e.g. click on the x column to select all acceleration data for the x axis)</li>
<li>Click on the graph icon in the top left corner</li>
<li>Choose the data for the abscissa (e.g. the timestamp column)</li>
<li>Click on the “OK” button</li>
</ol>
<p>The screenshot below shows an example of such a graph:</p>
<p><img src="Documentation/Pictures/HDFView-Graph.png" alt="Acceleration Graph in HDFView" /></p>
<p>For a more advanced analysis of the data files you can use our collection of measurement utility software <a href="https://github.com/MyTooliT/ICOlyzer">ICOlyzer</a>.</p>
<div id="adding-custom-metadata" class="section level4 hasAnchor" number="1.3.3.1">
<h4><span class="header-section-number">1.3.3.1</span> Adding Custom Metadata<a href="#adding-custom-metadata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Sometimes you also want to add additional data about a measurement. To do that you can also use <a href="https://www.hdfgroup.org/downloads/hdfview/">HDFView</a>. Since the tool opens files in read-only mode by default you need to change the default file access mode to “Read/Write” first:</p>
<ol style="list-style-type: decimal">
<li>Open <a href="https://www.hdfgroup.org/downloads/hdfview/">HDFView</a></li>
<li>Click on “Tools” → “User Options”</li>
<li>Select “General Settings”</li>
<li>Under the text “Default File Access Mode” choose “Read/Write”</li>
<li>Close HDFView</li>
</ol>
<p>Now you should be able to add and modify attributes. For example, to add a revolutions per minute (RPM) value of <code>15000</code> you can use the following steps:</p>
<ol style="list-style-type: decimal">
<li>Open the measurement file in <a href="https://www.hdfgroup.org/downloads/hdfview/">HDFView</a></li>
<li>Click on the table “acceleration” in the left part of the window</li>
<li>In the tab “Object Attribute Info” on the right, click on the button “Add attribute”</li>
<li>Check that “Object List” contains the value “/acceleration”</li>
<li>Enter the text “RPM” in the field “Name”</li>
<li>In the field “Value” enter the text “15000”</li>
<li>The “Datatype Class” should be set to “INTEGER”</li>
<li>For the size (in bits) choose a bit length that is large enough to store the value. In our example everything equal to or larger than 16 bits should work.</li>
<li>Optionally you can also check “Unsigned”, if you are sure that you only want to store positive values</li>
<li>Click the button “OK”</li>
</ol>
<p><img src="Documentation/Pictures/HDFView-RPM.png" alt="HDFView: RPM Attribute" /></p>
<p>Sometimes you also want to add some general purpose data. For that you can use the “STRING” datatype class. For example, to store the text “hello world” in an attribute called “Comment” you can do the following</p>
<ol style="list-style-type: decimal">
<li>Repeat steps 1. – 4. from above</li>
<li>Choose “STRING” as “Datatype Class”</li>
<li>Under “Array Size” choose a length that is large enough to store the text such as “1000” (every size larger than or equal to 11 characters should work)</li>
<li>Click the button “OK”</li>
</ol>
<p><img src="Documentation/Pictures/HDFView-Comment.png" alt="HDFView: Comment Attribute" /></p>
<p>If you want you can also add multiline text. Since you can not add newlines using <kbd>⏎</kbd> in HDFView directly, we recommend you open your favorite text editor to write the text and then copy and paste the text into the value field. HDFView will only show the last line of the pasted text. However, after you copy and paste the text into another program you will see that HDFView stored the text including the newlines.</p>
</div>
</div>
<div id="changing-configuration-values" class="section level3 hasAnchor" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> Changing Configuration Values<a href="#changing-configuration-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p><strong>Note:</strong> If you only use the <code>icoc</code> command line tool, then you most probably do not need to change the configuration at all.</p>
</blockquote>
<p>All configuration options are currently stored in <a href="https://yaml.org">YAML</a> files (handled by the configuration library <a href="https://www.dynaconf.com">Dynaconf</a>). The <a href="https://github.com/MyTooliT/ICOc/blob/master/mytoolit/config/config.yaml">default values</a> are stored inside the package itself. If you want to overwrite or extend these values you should create a user configuration file. To do that you can use the command:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">icon</span> config</span></code></pre></div>
<p>which will open the the user configuration in your default text editor. You can then edit this file and save your changes to update the configuration. For a list of available options, please take a look at the <a href="https://github.com/MyTooliT/ICOc/blob/master/mytoolit/config/config.yaml">default configuration</a>. Please make sure to not make any mistakes when you edit this file. Otherwise (parts of) the ICOc commands will not work, printing an error message about the (first) incorrect configuration value.</p>
<div id="adding-the-path-to-simplicity-commander-on-linux" class="section level4 hasAnchor" number="1.3.4.1">
<h4><span class="header-section-number">1.3.4.1</span> Adding the Path to Simplicity Commander on Linux<a href="#adding-the-path-to-simplicity-commander-on-linux" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>Open the user configuration file in your default text editor using the command line tool <code>icon</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">icon</span> config</span></code></pre></div></li>
<li><p>Add the path to Simplicity commander (e.g. <code>/opt/Simplicity Commander/commander/</code>) to the list <code>commands</code> → <code>path</code> → <code>linux</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">commands</span><span class="kw">:</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="at">  </span><span class="fu">path</span><span class="kw">:</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="at">    </span><span class="fu">linux</span><span class="kw">:</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> /opt/Simplicity Commander/commander/</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> Keys (such as <code>commands</code>, <code>path</code> and <code>linux</code>) in the example above are case-insensitive in <a href="https://www.dynaconf.com">Dynaconf</a>, e.g. it does not matter if you use <code>commands</code> or <code>COMMANDS</code> in the example above.</p>
</blockquote></li>
<li><p>Store the modified configuration file</p></li>
</ol>

</div>
</div>
</div>
</div>
<div id="tutorials" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Tutorials<a href="#tutorials" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="tutorials:section:sth-renaming" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Sensor Device Renaming<a href="#tutorials:section:sth-renaming" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Please start ICOc:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">icoc</span></span></code></pre></div></li>
<li><p>The text based interface will show you a selection of the available devices:</p>
<pre><code>                ICOc

       Name      Address            RSSI
———————————————————————————————————————————————
    1: Serial    08:6b:d7:01:de:81  -44 dBm

┌──────────────────────────────┐
│ 1-9: Connect to STH          │
│                              │
│   f: Change Output File Name │
│   n: Change STH Name         │
│                              │
│   q: Quit ICOc               │
└──────────────────────────────┘</code></pre>
<p>Choose the STH you want to rename by entering the number to the left of the device (here <code>1</code>). To confirm your selection press the return key <kbd>⮐</kbd>.</p></li>
<li><p>Now the menu should look like this:</p>
<pre><code>                ICOc
STH “Serial” (08:6b:d7:01:de:81)
————————————————————————————————

Hardware Version      1.4.0
Firmware Version      2.1.10
Firmware Release Name Tanja
Serial Number         –

Supply Voltage        3.16 V
Chip Temperature      26.2 °C

Run Time              ∞ s

Prescaler             2
Acquisition Time      8
Oversampling Rate     64
⇒ Sampling Rate       9524
Reference Voltage     VDD

Sensors               M1: S1

┌───────────────────────────┐
│ s: Start Data Acquisition │
│                           │
│ n: Change STH Name        │
│ r: Change Run Time        │
│ a: Configure ADC          │
│ p: Configure Sensors      │
│ O: Set Standby Mode       │
│                           │
│ q: Disconnect from STH    │
└───────────────────────────┘</code></pre>
<p>Press the button <code>n</code> to change the name.</p></li>
<li><p>Enter the new device name.</p>
<pre><code>New STH name (max. 8 characters): Blubb</code></pre>
<p>Confirm the name with the return key <kbd>⮐</kbd>.</p></li>
<li><p>The interface should now show you the menu of step 3. To disconnect from the holder press <kbd>e</kbd>.</p></li>
<li><p>Now you see the main menu of ICOc. The STH will show up under the name you used in step 4.</p></li>
<li><p>To exit ICOc, please use the key <kbd>q</kbd>.</p></li>
</ol>
</div>
<div id="command-line-usage-of-icoc" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Command Line Usage of ICOc<a href="#command-line-usage-of-icoc" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The ICOc program accepts optional command line arguments at startup. This way you can set default values for often used options. If you specify</p>
<ul>
<li>the name or</li>
<li>Bluetooth address</li>
</ul>
<p>of a sensor device, then you can even use ICOc without any user interaction, since in this case the program will immediately connect to the specified device and start the measurement process.</p>
<div id="tutorials:section:available-options" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Available Options<a href="#tutorials:section:available-options" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To show the available command line options you can use the option <code>-h</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-h</span></span></code></pre></div>
<p>which should show you the following output:</p>
<pre><code>usage: icoc [-h] [-b BLUETOOTH_ADDRESS | -n [NAME]] [-f FILENAME] [-r SECONDS] [-1 [FIRST_CHANNEL]] [-2 [SECOND_CHANNEL]] [-3 [THIRD_CHANNEL]] [-s 2–127] [-a {1,2,3,4,8,16,32,64,128,256}]
            [-o {1,2,4,8,16,32,64,128,256,512,1024,2048,4096}] [-v {1V25,Vfs1V65,Vfs1V8,Vfs2V1,Vfs2V2,2V5,Vfs2V7,VDD,5V,6V6}] [--log {debug,info,warning,error,critical}]

Configure and measure data with the ICOtronic system

options:
  -h, --help            show this help message and exit

Connection:
  -b BLUETOOTH_ADDRESS, --bluetooth-address BLUETOOTH_ADDRESS
                        connect to device with specified Bluetooth address (e.g. “08:6b:d7:01:de:81”)
  -n [NAME], --name [NAME]
                        connect to device with specified name

Measurement:
  -f FILENAME, --filename FILENAME
                        base name of the output file (default: Measurement)
  -r SECONDS, --run-time SECONDS
                        run time in seconds (values equal or below “0” specify infinite runtime) (default: 0)
  -1 [FIRST_CHANNEL], --first-channel [FIRST_CHANNEL]
                        sensor channel number for first measurement channel (1 - 255; 0 to disable) (default: 1)
  -2 [SECOND_CHANNEL], --second-channel [SECOND_CHANNEL]
                        sensor channel number for second measurement channel (1 - 255; 0 to disable) (default: 0)
  -3 [THIRD_CHANNEL], --third-channel [THIRD_CHANNEL]
                        sensor channel number for third measurement channel (1 - 255; 0 to disable) (default: 0)

ADC:
  -s 2–127, --prescaler 2–127
                        Prescaler value (default: 2)
  -a {1,2,3,4,8,16,32,64,128,256}, --acquisition {1,2,3,4,8,16,32,64,128,256}
                        Acquisition time value (default: 8)
  -o {1,2,4,8,16,32,64,128,256,512,1024,2048,4096}, --oversampling {1,2,4,8,16,32,64,128,256,512,1024,2048,4096}
                        Oversampling rate value (default: 64)
  -v {1V25,Vfs1V65,Vfs1V8,Vfs2V1,Vfs2V2,2V5,Vfs2V7,VDD,5V,6V6}, --voltage-reference {1V25,Vfs1V65,Vfs1V8,Vfs2V1,Vfs2V2,2V5,Vfs2V7,VDD,5V,6V6}
                        Reference voltage (default: VDD)

Logging:
  --log {debug,info,warning,error,critical}
                        Minimum level of messages written to log (default: info)</code></pre>
<p>All options below the section “Measurement” and “ADC” in the <a href="#tutorials:section:available-options">help output of ICOc</a> allow you to change a specific configuration value before you start ICOc.</p>
</div>
<div id="channel-selection" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Channel Selection<a href="#channel-selection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To enable the measurement for the first (“x”) channel and second (“y”) channel of an “older” STH (Firmware <code>2.x</code>, <code>BGM113</code> chip) you can use the following command:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-1</span> 1 <span class="at">-2</span> 1 <span class="at">-3</span> 0</span></code></pre></div>
<p>Here <code>0</code> indicates that you want to disable the channel, while a positive number (such as <code>1</code>) specifies that the measurement for the channel should take place. Since the default value</p>
<ul>
<li>for the option <code>-1</code> is already <code>1</code>, and</li>
<li>for the option <code>-3</code> is already <code>0</code></li>
</ul>
<p>you can also leave out these options to arrive at the shorter command:</p>
<pre><code>icoc -2 1</code></pre>
<blockquote>
<p><strong>Note:</strong> Due to a problem in the current firmware the amount of <strong>paket loss is much higher</strong>, if you</p>
<ul>
<li>use the standard ADC configuration values, and</li>
<li>enable data transmission for <strong>exactly 2 (channels)</strong>.</li>
</ul>
<p>We strongly recommend you <strong>use either one or three channels</strong>.</p>
</blockquote>
<p>For newer STH versions (Firmware <code>3.x</code>, <code>BGM121</code> chip) or SMHs (Sensory Milling Heads) you can also change the hardware/sensor channel for the first, second and third measurement channel. For example, to select</p>
<ul>
<li>hardware channel 8 for the first measurement channel</li>
<li>hardware channel 1 for the second measurement channel, and</li>
<li>hardware channel 3 for the third measurement channel</li>
</ul>
<p>you can use the following command:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-1</span> 8 <span class="at">-2</span> 1 <span class="at">-3</span> 3</span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> If you connect to an older STH using the command above, then the command would just enable the measurement for all three measurement channels, but not change the selected hardware channel.</p>
</blockquote>
<p>If you just want to enable/set a measurement channel and use the hardware channel with the same number you can also just leave the argument for the specific measurement channel empty. For example, to use</p>
<ul>
<li>hardware channel 1 for measurement channel 1,</li>
<li>hardware channel 2 for measurement channel 2, and</li>
<li>hardware channel 3 for measurement channel 3</li>
</ul>
<p>you can use the following command:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-1</span> <span class="at">-2</span> <span class="at">-3</span></span></code></pre></div>
<p>or even shorter, since the default value for measurement channel 1 is hardware channel 1:</p>
<pre><code>icoc -2 -3</code></pre>
</div>
<div id="changing-the-run-time" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Changing the Run Time<a href="#changing-the-run-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To change the run time of the measurement you can use the option <code>-r</code>, which takes the runtime in seconds as argument. The command</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-r</span> 300</span></code></pre></div>
<p>for example, would change the runtime to 300 seconds (5 minutes).</p>
</div>
<div id="start-the-measurement" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Start the Measurement<a href="#start-the-measurement" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you specify one of the options</p>
<ul>
<li><code>-b</code>/<code>--bluetooth-address</code> or</li>
<li><code>-n</code>/<code>--name</code></li>
</ul>
<p>then ICOC will try to connect immediately to the specified device and start the measurement run. For example, to acquire acceleration data from the device with the (Bluetooth advertisement) <strong>name “Blubb”</strong> you can use the following command:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-n</span> Blubb</span></code></pre></div>
<p>To read acceleration values for <strong><code>5</code> seconds</strong> from the device with the <strong>Bluetooth address <code>08:6b:d7:01:de:81</code></strong> you can use the following command:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-b</span> 08:6b:d7:01:de:81 <span class="at">-r</span> 5</span></code></pre></div>
</div>
<div id="changing-the-logging-level" class="section level3 hasAnchor" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Changing the Logging Level<a href="#changing-the-logging-level" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>By default ICOc only writes log messages of level <code>INFO</code> or higher. In some situations, for example when ICOc behaves incorrectly, you might want to set a lower level. You can do that using the option <code>--log</code>. For example, to activate logging of level <code>WARNING</code> and higher when you start ICOc you can use the following command:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">--log</span> warning</span></code></pre></div>
<p>The different logs for ICOc are stored in the user log directory in the following files:</p>
<ul>
<li><code>cli.log</code>: Log messages of ICOc</li>
<li><code>network.log</code>: Log messages of CAN network class</li>
<li><code>plotter.log</code>: Log messages of plotter (process for measurement graph)</li>
</ul>
<p>To determine the user log directory on your machine you can use the following Python code:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="im">from</span> platformdirs <span class="im">import</span> user_log_path</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="bu">print</span>(user_log_path(appname<span class="op">=</span><span class="st">&quot;ICOc&quot;</span>, appauthor<span class="op">=</span><span class="st">&quot;MyTooliT&quot;</span>))</span></code></pre></div>
</div>
<div id="changing-the-reference-voltage" class="section level3 hasAnchor" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Changing the Reference Voltage<a href="#changing-the-reference-voltage" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For certain sensor devices you have to change the reference voltage to retrieve a proper measurement value. For example, STHs that use a ± 40 g acceleration sensor (<a href="https://www.analog.com/en/products/adxl356.html">ADXL356</a>) require a reference voltage of 1.8 V instead of the usual supply voltage (<code>VDD</code>) of 3.3 V. To select the correct reference voltage for these devices at startup use the option <code>-v Vfs1V8</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-v</span> Vfs1V8</span></code></pre></div>
</div>
<div id="changing-the-sampling-rate" class="section level3 hasAnchor" number="2.2.7">
<h3><span class="header-section-number">2.2.7</span> Changing the Sampling Rate<a href="#changing-the-sampling-rate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you want to change the sampling rate you can do that by changing the parameters of the ADC. There are 3 parameters which influence the sampling rate.</p>
<ul>
<li><strong>Prescaler</strong> (Prescaler used by the ADC to get the sample points)</li>
<li><strong>Acquisition Time</strong> (Time the ADC holds a value to get a sampling point)</li>
<li><strong>Oversampling Rate</strong> (Oversampling rate of the ADC)</li>
</ul>
<p>The formula which can be used to calculate the sampling rate can be found in the <a href="https://mytoolit.github.io/Documentation/#sampling-rate">documentation of the CAN commands</a>.</p>
</div>
</div>
<div id="icon-cli-tool" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> ICOn CLI Tool<a href="#icon-cli-tool" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One issue of the ICOc (command line tool) is that it <strong>only works on Windows</strong>. Another problem is that it <strong>requires a CAN adapter from <a href="https://www.peak-system.com">PEAK-System</a></strong>.</p>
<p>To improve this situation we offer an <a href="https://icoc.readthedocs.io">API</a> (Application Programming Interface) based on <a href="https://python-can.readthedocs.io">python-can</a>, which works on</p>
<ul>
<li>Linux,</li>
<li>macOS, and</li>
<li>Windows</li>
</ul>
<p>and should (at least in theory) support the <a href="https://python-can.readthedocs.io/en/master/interfaces.html">same CAN hardware as python-can</a>. You can access most of this <a href="https://icoc.readthedocs.io">API</a> using the “new” Network class.</p>
<p>We also offer a (currently very limited) CLI tool based on this <a href="https://icoc.readthedocs.io">API</a> called ICOn. The text below describes how you can use this tool.</p>
<div id="listing-available-sensor-devices" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Listing Available Sensor Devices<a href="#listing-available-sensor-devices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To print a list of all available sensor devices please use the subcommand <code>list</code>:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="ex">icon</span> list</span></code></pre></div>
</div>
<div id="collecting-measurement-data" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Collecting Measurement Data<a href="#collecting-measurement-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To collect and store measurement data from an STH you can uses the subcommand <code>measure</code>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="ex">icon</span> measure</span></code></pre></div>
<p>By default the command will collect streaming data for 10 seconds for the first measurement channel and store the data as <code>Measurement.hdf5</code> in the current working directory. You can change the default measurement duration using the option <code>-t</code>/<code>--time</code>. For example to collect measurement data for 1.5 seconds from the STH with the name <code>Test-STH</code> use the command:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-t</span> 1.5 <span class="at">-n</span> Test-STH</span></code></pre></div>
</div>
<div id="renaming-a-sensor-device" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Renaming a Sensor Device<a href="#renaming-a-sensor-device" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To change the name of a sensor you can use the subcommand <code>rename</code>. For example to change the name of the sensor device with the Bluetooth MAC address <code>08-6B-D7-01-DE-81</code> to <code>Test-STH</code> use the following command:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="ex">icon</span> rename <span class="at">-m</span> 08-6B-D7-01-DE-81 Test-STH</span></code></pre></div>
<p>For more information about the command you can use the option <code>-h</code>/<code>--help</code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="ex">icon</span> rename <span class="at">-h</span></span></code></pre></div>
</div>
<div id="opening-the-user-configuration" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Opening the User Configuration<a href="#opening-the-user-configuration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To open the user configuration file, you can use the subcommand <code>config</code>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="ex">icon</span> config</span></code></pre></div>
<p>If the file does not exist yet, then it will be created and filled with the content of the <a href="https://github.com/MyTooliT/ICOc/blob/master/mytoolit/config/user.yaml">default user configuration</a>. For more information on how to change the configuration, please take a look <a href="#changing-configuration-values">here</a>.</p>
</div>
<div id="stu-commands" class="section level3 hasAnchor" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> STU Commands<a href="#stu-commands" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To list all available STU subcommands, please use the option <code>-h</code> (or <code>--help</code>):</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="ex">icon</span> stu <span class="at">-h</span></span></code></pre></div>
<div id="enable-stu-ota-mode" class="section level4 hasAnchor" number="2.3.5.1">
<h4><span class="header-section-number">2.3.5.1</span> Enable STU OTA Mode<a href="#enable-stu-ota-mode" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To enable the Bluetooth advertising of the STU and hence the “over the air” firmware update, please run the following command:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="ex">icon</span> stu ota</span></code></pre></div>
</div>
<div id="retrieve-the-bluetooth-stu-mac-address" class="section level4 hasAnchor" number="2.3.5.2">
<h4><span class="header-section-number">2.3.5.2</span> Retrieve the Bluetooth STU MAC Address<a href="#retrieve-the-bluetooth-stu-mac-address" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To retrieve the STU Bluetooth address you can use the following command:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="ex">icon</span> stu mac</span></code></pre></div>
</div>
<div id="reset-stu" class="section level4 hasAnchor" number="2.3.5.3">
<h4><span class="header-section-number">2.3.5.3</span> Reset STU<a href="#reset-stu" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To reset the STU please use the following command:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="ex">icon</span> stu reset</span></code></pre></div>
</div>
</div>
</div>
<div id="production-tests" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Production Tests<a href="#production-tests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This tutorial lists the usual steps to test a sensory holder assembly or a sensory tool holder.</p>
<div id="tutorials:section:general" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> General<a href="#tutorials:section:general" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To run the production tests for one of the ICOtronic devices, please execute one of the following commands:</p>
<table>
<colgroup>
<col width="84%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th>Device</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Stationary Transceiver Unit (STU)</td>
<td><code>test-stu</code></td>
</tr>
<tr class="even">
<td>Sensory Holder Assembly (SHA), Sensory Tool Holder (STH)</td>
<td><code>test-sth</code></td>
</tr>
<tr class="odd">
<td>Sensory Milling Head (SMH)</td>
<td><code>test-smh</code></td>
</tr>
</tbody>
</table>
<p>For a list of available command line options, please use the option <code>-h</code> after one of the commands e.g.:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="ex">test-sth</span> <span class="at">-h</span></span></code></pre></div>
<div id="specific-tests" class="section level4 hasAnchor" number="2.4.1.1">
<h4><span class="header-section-number">2.4.1.1</span> Specific Tests<a href="#specific-tests" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To only run a single test you need the specify its name. For example, to run the test <code>test__firmware_flash</code> of the STU you can use the following command:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="ex">test-stu</span> TestSTU.test__firmware_flash</span></code></pre></div>
<p>You can also run specific tests using pattern matching. To do that use the command line option <code>-k</code>. For example to run the firmware flash and the connection test of the STH test you can use the command:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="ex">test-sth</span> <span class="at">-k</span> flash <span class="at">-k</span> connection</span></code></pre></div>
<p>which executes all tests that contain the text <code>flash</code> or <code>connection</code>.</p>
</div>
</div>
<div id="tutorials:section:sth" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> STH<a href="#tutorials:section:sth" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The text below gives you a more detailed step-by-step guide on how to run the tests of the STH.</p>
<ol style="list-style-type: decimal">
<li><blockquote>
<p><strong>Note:</strong> You can <strong>skip this step, if you do not want to run the flash test</strong>. To skip the flash test, please set <code>sth</code> → <code>status</code> in the <a href="#changing-configuration-values">configuration</a> to <code>Epoxied</code>.</p>
</blockquote>
<p>Please create a directory called <code>Firmware</code> in the current user’s <code>Documents</code> directory (<code>~/Documents</code>).</p>
<blockquote>
<p><strong>Note:</strong> To open the user’s home directory on Windows you can use the following command in (Windows) Terminal:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="ex">ii</span> ~/Documents</span></code></pre></div>
</blockquote>
<p>Then put the <a href="https://github.com/MyTooliT/STH/releases/download/2.1.10/manufacturingImageSthv2.1.10.hex">current version of the STH firmware</a> into this directory. Afterwards the directory and file structure should look like this:</p>
<pre><code>~
└── Documents
        └── Firmware
                └── manufacturingImageSthv2.1.10.hex</code></pre>
<p>As alternative to the steps above you can also change the variable <code>sth</code> → <code>firmware</code> → <code>location</code> → <code>flash</code> in the <a href="#changing-configuration-values">configuration</a> to point to the firmware that should be used for the flash test.</p></li>
<li><p>Make sure that <a href="#changing-configuration-values">the configuration values</a> are set correctly. You probably need to change at least the following variables:</p>
<ul>
<li><p><strong>Name</strong>: Please change the Bluetooth advertisement name (<code>sth</code> → <code>name</code> ) to the name of the STH you want to test.</p></li>
<li><p><strong>Serial Number of Programming Board</strong>: Please make sure, that the variable <code>sth</code> → <code>programming board</code> → <code>serial number</code> contains the serial number of the programming board connected to the STH. This serial number should be displayed on the bottom right of the LCD on the programming board.</p></li>
</ul></li>
<li><p>Please open your favorite Terminal application and execute, the STH test using the command <code>test-sth</code>. For more information about this command, please take a look at the section <a href="#tutorials:section:general">“General”</a> above.</p>
<p>Please note, that the test will rename the tested STH</p>
<ul>
<li><p>to a <a href="#mac-address-conversion"><strong>Base64 encoded version of the Bluetooth MAC address</strong></a>, if <code>sth</code> → <code>status</code> is set to <code>Bare PCB</code>, or</p></li>
<li><p>to the <strong>serial number</strong> (<code>sth</code> → <code>programming board</code> → <code>serial number</code>), if you set the status to <code>Epoxied</code>.</p></li>
</ul></li>
</ol>
</div>
<div id="tutorials:section:smh" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> SMH<a href="#tutorials:section:smh" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The preparation steps for the SMH test are very similar to the ones of the <a href="#tutorials:section:sth">STH test</a>.</p>
<ol style="list-style-type: decimal">
<li><p>Please make sure that the config value that stores the SMH firmware filepath (<code>smh</code> → <code>firmware</code> → <code>location</code> → <code>flash</code>) points to the correct firmware. If you have not downloaded a firmware image for the SMH you can do so <a href="https://github.com/MyTooliT/STH/releases">here</a>.</p></li>
<li><p>Check that the <a href="#changing-configuration-values">configuration values</a> like SMH name (<code>smh</code> → <code>name</code>) and programming board serial number (<code>smh</code> → <code>programming board</code> → <code>serial number</code>) are set correctly.</p></li>
<li><p>Please execute the test using the following command:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="ex">test-smh</span></span></code></pre></div></li>
</ol>
</div>
<div id="tutorials:section:stu" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> STU<a href="#tutorials:section:stu" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following description shows you how to run the STU tests.</p>
<ol style="list-style-type: decimal">
<li><blockquote>
<p><strong>Note:</strong> You can <strong>skip this step, if you do not want to run the flash test</strong>.</p>
</blockquote>
<p>Please take a look at step 1 of the description for the <a href="#tutorials:section:sth">STH test</a> and replace every occurrence of STH (or <code>sth</code>) with STU (or <code>stu</code>).</p>
<blockquote>
<p><strong>Note:</strong> The STU test always uploads the flash file to the board, i.e. the setting <code>stu</code> → <code>status</code> is <strong>not</strong> read/used by the STU tests.</p>
</blockquote>
<p>In the end of this step the directory structure should look like this:</p>
<pre><code>~
└── Documents
       └── Firmware
              └── manufacturingImageStuv2.1.10.hex</code></pre>
<p>You can find the current version of the STU firmware <a href="https://github.com/MyTooliT/STU/releases">here</a>.</p></li>
<li><p>Please take a look at the section <a href="#tutorials:section:general">“General”</a> to find out how to execute the production tests for the STU. If you want to run the connection and EEPROM test (aka <strong>all tests except the flash test</strong>), then please execute the following command:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="ex">test-stu</span> <span class="at">-k</span> eeprom <span class="at">-k</span> connection</span></code></pre></div></li>
</ol>
</div>
<div id="firmware-versions" class="section level3 hasAnchor" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Firmware Versions<a href="#firmware-versions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The (non-exhaustive) table below shows the compatible firmware for a certain device. The production tests assume that you use <strong>firmware that includes the bootloader</strong>.</p>
<table>
<colgroup>
<col width="2%" />
<col width="7%" />
<col width="7%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th>Device</th>
<th>Hardware Version</th>
<th>Microcontroller</th>
<th>Firmware</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>STH</td>
<td><code>1.3</code></td>
<td>BGM113</td>
<td>• <a href="https://github.com/MyTooliT/STH/releases/tag/2.1.10">Version 2.1.10</a></td>
</tr>
<tr class="even">
<td>STH</td>
<td><code>2.2</code></td>
<td>BGM123</td>
<td>• <a href="https://github.com/MyTooliT/STH/releases/tag/Aladdin">Aladdin</a></td>
</tr>
<tr class="odd">
<td>SMH</td>
<td><code>2.1</code></td>
<td>BGM121</td>
<td>• <a href="https://github.com/MyTooliT/STH/releases/tag/3.0.0">Version 3.0.0</a> <br/>• <a href="https://github.com/MyTooliT/STH/releases/tag/E3016_BETA(11_Sensors)">Version E3016 Beta</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="verification-tests" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Verification Tests<a href="#verification-tests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="preparation" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Preparation<a href="#preparation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The tests assume that the name of the STH is stored in <code>sth</code> → <code>name</code> in the <a href="#changing-configuration-values">configuration</a>.</li>
<li>Some of the STH tests assume that you connected the SHA/STH or STU via the programming cable. Please do that, since otherwise these tests will fail.</li>
</ul>
</div>
<div id="execution" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Execution<a href="#execution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To run the verification tests for the STH, please enter the following command:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="ex">test-sth-verification</span> <span class="at">-v</span></span></code></pre></div>
<p>To execute the STU verification tests, you can use the command:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="ex">test-stu-verification</span> <span class="at">-v</span></span></code></pre></div>
<p>Please note that while most of the tests should run successfully, if you use working hardware and firmware, some of them might fail occasionally. In this case please rerun the specific test using the option <code>-k</code> and specifying a text that matches the name of the test. For example, to return the STH test <code>test0107BlueToothConnectMin</code> you can use the following command:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="ex">test-sth-verification</span> <span class="at">-v</span> <span class="at">-k</span> test0107</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>: If you want to stop the test while it is running, but <kbd>Ctrl</kbd> + <kbd>C</kbd> does not terminate the test as you expected, then you can use the command:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="ex">Stop-Process</span> <span class="at">-Name</span> python</span></code></pre></div>
<p>to stop <strong>all running Python interpreters</strong> and hence also the <code>test-sth-verification</code> script.</p>
</blockquote>
</div>
<div id="problematic-tests" class="section level3 hasAnchor" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Problematic Tests<a href="#problematic-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The tables below contains a list of tests that failed using a working SHA/STH and STU before. It should provide you with a good overview of which of the verification tests might fail, even if the hardware and firmware works correctly.</p>
<div id="sth" class="section level4 hasAnchor" number="2.5.3.1">
<h4><span class="header-section-number">2.5.3.1</span> STH<a href="#sth" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<table>
<colgroup>
<col width="4%" />
<col width="95%" />
</colgroup>
<thead>
<tr class="header">
<th>Date</th>
<th>Failed Tests</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2021-09-29</td>
<td>• test0107BlueToothConnectMin <br/> • test0332SignalIndicatorsAccZ <br/> • test0334SignalIndicatorsMulti <br/> • test0345MixedStreamingAccYZVoltBat</td>
</tr>
<tr class="even">
<td>2021-09-30</td>
<td>• test0332SignalIndicatorsAccZ <br/> • test0334SignalIndicatorsMulti <br/> • test0345MixedStreamingAccYZVoltBat</td>
</tr>
<tr class="odd">
<td>2021-09-30</td>
<td>• test0332SignalIndicatorsAccZ <br/> • test0334SignalIndicatorsMulti <br/> • test0532MessageCountersAccZBattery</td>
</tr>
<tr class="even">
<td>2021-10-05</td>
<td>• test0334SignalIndicatorsMulti <br/> • test0347StreamingAccXSingleBattery</td>
</tr>
<tr class="odd">
<td>2021-10-06</td>
<td>• test0109BlueToothRssi <br/> • test0334SignalIndicatorsMulti</td>
</tr>
<tr class="even">
<td>2021-10-06</td>
<td>• test0107BlueToothConnectMin <br/> • test0334SignalIndicatorsMulti <br/> • test0345MixedStreamingAccYZVoltBat</td>
</tr>
<tr class="odd">
<td>2021-10-07</td>
<td>• test0107BlueToothConnectMin <br/> • test0332SignalIndicatorsAccZ <br/> • test0334SignalIndicatorsMulti <br/> • test0344MixedStreamingAccXYVoltBat <br/> • test0345MixedStreamingAccYZVoltBat</td>
</tr>
<tr class="even">
<td>2021-10-11</td>
<td>• test0015PowerConsumptionEnergySaveMode2 <br/> • test0016PowerConsumptionEnergySaveModeAdv4000ms <br/> • test0332SignalIndicatorsAccZ <br/> • test0334SignalIndicatorsMulti <br/> • test0508AdcConfigSingle</td>
</tr>
<tr class="odd">
<td>2021-10-12</td>
<td>• test0332SignalIndicatorsAccZ <br/> • test0334SignalIndicatorsMulti <br/> • test0532MessageCountersAccZBattery</td>
</tr>
<tr class="even">
<td>2021-10-13</td>
<td>• test0332SignalIndicatorsAccZ <br/> • test0334SignalIndicatorsMulti <br/> • test0508AdcConfigSingle <br/> • test0509AdcConfigDouble <br/> • test0510AdcConfigTripple <br/> • test0525MessageCounterAccZ</td>
</tr>
<tr class="odd">
<td>2021-12-09</td>
<td>• test0107BlueToothConnectMin <br/> • test0510AdcConfigTripple <br/> • test0523MessageCounterAccX <br/> • test0527MessageCounterAccXZ <br/> • test0529MessageCounterAccXYZ <br/></td>
</tr>
<tr class="even">
<td>2021-12-14</td>
<td>• test0107BlueToothConnectMin</td>
</tr>
<tr class="odd">
<td>2022-05-17</td>
<td>• test0015PowerConsumptionEnergySaveMode2 <br/> • test0016PowerConsumptionEnergySaveModeAdv4000ms <br/> • test0334SignalIndicatorsMulti <br/> • test0344MixedStreamingAccXYVoltBat <br/> • test0357StreamingAccXYSingleBattery</td>
</tr>
</tbody>
</table>
</div>
<div id="stu" class="section level4 hasAnchor" number="2.5.3.2">
<h4><span class="header-section-number">2.5.3.2</span> STU<a href="#stu" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<table>
<thead>
<tr class="header">
<th>Date</th>
<th>Failed Tests</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2021-12-14</td>
<td>• test0102BlueToothConnectDisconnectDevice</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="code-examples" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Code Examples<a href="#code-examples" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>For information on how to write your own code including sample code please take a look at the <a href="https://icoc.readthedocs.io">API documentation</a>.</p>

</div>
<div id="virtualization" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Virtualization<a href="#virtualization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>You can also use (parts of) ICOc with various virtualization software. For that to work you have to make sure that (at least) the PEAK CAN adapter is attached to the virtual guest operating system. For some virtualization software you might have to install additional software for that to work. For example, <a href="https://www.virtualbox.org">VirtualBox</a> requires that you install the VirtualBox Extension Pack before you can use USB 2 and USB 3 devices.</p>
<blockquote>
<p><strong>Note:</strong> Please be advised that the <a href="https://www.virtualbox.org/wiki/Licensing_FAQ"><strong>VirtualBox Extension Pack is paid software</strong></a> even though you can download and use it without any license key. <strong><a href="https://www.reddit.com/r/sysadmin/comments/d1ttzp/oracle_is_going_after_companies_using_virtualbox/">Oracle might come after you, if you do not pay for the license</a></strong>, even if you use the Extension Pack in an educational setting.</p>
</blockquote>
<p>The table below shows some of the virtualization software we tried and that worked (when we tested it).</p>
<table>
<colgroup>
<col width="11%" />
<col width="3%" />
<col width="7%" />
<col width="5%" />
<col width="8%" />
<col width="64%" />
</colgroup>
<thead>
<tr class="header">
<th>Virtualization Software</th>
<th>Host OS</th>
<th>Host Architecture</th>
<th>Guest OS</th>
<th>Guest Architecture</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://www.parallels.com">Parallels Desktop</a></td>
<td>macOS</td>
<td><code>x64</code></td>
<td>Ubuntu 20.04</td>
<td><code>x64</code></td>
<td></td>
</tr>
<tr class="even">
<td><a href="https://www.parallels.com">Parallels Desktop</a></td>
<td>macOS</td>
<td><code>x64</code></td>
<td>Windows 10</td>
<td><code>x64</code></td>
<td></td>
</tr>
<tr class="odd">
<td><a href="https://www.parallels.com">Parallels Desktop</a></td>
<td>macOS</td>
<td><code>ARM64</code></td>
<td>Fedora 36</td>
<td><code>ARM64</code></td>
<td></td>
</tr>
<tr class="even">
<td><a href="https://www.parallels.com">Parallels Desktop</a></td>
<td>macOS</td>
<td><code>ARM64</code></td>
<td>Windows 11</td>
<td><code>ARM64</code>, <code>x64</code></td>
<td>JLink (and hence Simplicity Commander) only works with <a href="https://wiki.segger.com/J-Link_on_Windows_ARM">programming adapters that support WinUSB</a></td>
</tr>
<tr class="odd">
<td><a href="https://www.virtualbox.org">VirtualBox</a></td>
<td>macOS</td>
<td><code>x64</code></td>
<td>Windows 10</td>
<td><code>x64</code></td>
<td></td>
</tr>
<tr class="even">
<td><a href="https://www.virtualbox.org">VirtualBox</a></td>
<td>Windows</td>
<td><code>x64</code></td>
<td>Fedora 36</td>
<td><code>x64</code></td>
<td></td>
</tr>
<tr class="odd">
<td><a href="http://aka.ms/wsl">WSL 2</a></td>
<td>Windows</td>
<td><code>x64</code></td>
<td>Ubuntu 22.04</td>
<td><code>x64</code></td>
<td></td>
</tr>
</tbody>
</table>
<div id="windows-subsystem-for-linux-2" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Windows Subsystem for Linux 2<a href="#windows-subsystem-for-linux-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using ICOc in the WSL 2 currently <a href="https://github.com/microsoft/WSL/issues/5533">requires using a custom Linux kernel</a>. We <strong>would not recommend</strong> using ICOc with this type of virtualization software, since the setup requires quite some amount of work and time. Nevertheless the steps below should show you how you can use the PEAK CAN adapter and hence ICOc with WSL 2.</p>
<ol style="list-style-type: decimal">
<li><p>Install WSL 2 (Windows Shell):</p>
<pre><code>wsl --install</code></pre></li>
<li><p>Install Ubuntu 22.04 VM (Windows Shell):</p>
<ol style="list-style-type: decimal">
<li><p>Install <a href="https://apps.microsoft.com/store/detail/ubuntu-2204-lts/9PN20MSR04DW">Ubuntu 22.04 from the Microsoft Store</a></p></li>
<li><p>Open the Ubuntu 22.04 application</p>
<ol style="list-style-type: decimal">
<li>Choose a user name</li>
<li>Choose a password</li>
</ol></li>
<li><p>Execute the following commands in a Powershell session</p>
<pre class="pwsh"><code>wsl --setdefault Ubuntu-22.04
wsl --set-version Ubuntu-22.04 2</code></pre>
<p>The second command might fail, if <code>Ubuntu-22.04</code> already uses WSL 2. In this case please just ignore the error message.</p></li>
</ol></li>
<li><p><a href="https://github.com/dorssel/usbipd-win/wiki/WSL-support#building-your-own-usbip-enabled-wsl-2-kernel">Create Custom Kernel</a></p>
<p>Windows Shell:</p>
<blockquote>
<p><strong>Note:</strong> Please replace <code>&lt;user&gt;</code> with your (Linux) username (e.g. <code>rene</code>)</p>
</blockquote>
<pre class="pwsh"><code>cd ~/Documents
mkdir WSL
cd WSL
wsl --export Ubuntu-22.04 CANbuntu.tar
wsl --import CANbuntu CANbuntu CANbuntu.tar
wsl --distribution CANbuntu --user &lt;user&gt;</code></pre>
<p>Linux Shell:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a><span class="fu">sudo</span> apt upgrade <span class="at">-y</span></span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> bc build-essential flex bison libssl-dev libelf-dev <span class="dt">\</span></span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a>                    libncurses-dev autoconf libudev-dev libtool dwarves</span>
<span id="cb65-5"><a href="#cb65-5" tabindex="-1"></a><span class="bu">cd</span> ~</span>
<span id="cb65-6"><a href="#cb65-6" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/microsoft/WSL2-Linux-Kernel.git</span>
<span id="cb65-7"><a href="#cb65-7" tabindex="-1"></a><span class="bu">cd</span> WSL2-Linux-Kernel</span>
<span id="cb65-8"><a href="#cb65-8" tabindex="-1"></a><span class="fu">uname</span> <span class="at">-r</span> <span class="co"># 5.15.74.2-microsoft-standard-WSL2 → branch …5.15.y</span></span>
<span id="cb65-9"><a href="#cb65-9" tabindex="-1"></a><span class="fu">git</span> checkout linux-msft-wsl-5.15.y</span>
<span id="cb65-10"><a href="#cb65-10" tabindex="-1"></a><span class="fu">cat</span> /proc/config.gz <span class="kw">|</span> <span class="fu">gunzip</span> <span class="op">&gt;</span> .config</span>
<span id="cb65-11"><a href="#cb65-11" tabindex="-1"></a><span class="fu">make</span> menuconfig</span></code></pre></div>
<p>Make sure the following features are enabled:</p>
<ul>
<li><code>Device Drivers</code> → <code>USB Support</code></li>
<li><code>Device Drivers</code> → <code>USB Support</code> → <code>USB announce new devices</code></li>
<li><code>Device Drivers</code> → <code>USB Support</code> → <code>USB Modem (CDC ACM) support</code></li>
<li><code>Device Drivers</code> → <code>USB Support</code> → <code>USB/IP</code></li>
<li><code>Device Drivers</code> → <code>USB Support</code> → <code>USB/IP</code> → <code>VHCI HCD</code></li>
<li><code>Device Drivers</code> → <code>USB Support</code> → <code>USB Serial Converter Support</code></li>
<li><code>Device Drivers</code> → <code>USB Support</code> → <code>USB Serial Converter Support</code> → <code>USB FTDI Single port Serial Driver</code></li>
</ul>
<p>Enable the following features:</p>
<ul>
<li><code>Networking support</code> → <code>CAN bus subsystem support</code></li>
<li><code>Networking support</code> → <code>CAN bus subsystem support</code> → <code>Raw CAN Protocol</code></li>
<li><code>Networking support</code> → <code>CAN bus subsystem support</code> → <code>CAN device drivers</code> → <code>Virtual Local CAN Interface</code></li>
<li><code>Networking support</code> → <code>CAN bus subsystem support</code> → <code>CAN device drivers</code> → <code>Serial / USB serial CAN Adaptors (slcan)</code></li>
<li><code>Networking support</code> → <code>CAN bus subsystem support</code> → <code>CAN device drivers</code> → <code>CAN USB Interfaces</code> → <code>PEAK PCAN-USB/USB Pro interfaces for CAN 2.0b/CAN-FD</code></li>
</ul>
<p>Save the modified kernel configuration.</p>
<p>Linux Shell:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="fu">touch</span> .scmversion</span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a><span class="fu">sudo</span> make modules_install</span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a><span class="fu">sudo</span> make install</span></code></pre></div></li>
<li><p>Install <code>usbipd-win</code> (Linux Shell):</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="bu">cd</span> tools/usb/usbip</span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a><span class="ex">./autogen.sh</span></span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a><span class="ex">./configure</span></span>
<span id="cb67-4"><a href="#cb67-4" tabindex="-1"></a><span class="fu">sudo</span> make install</span>
<span id="cb67-5"><a href="#cb67-5" tabindex="-1"></a><span class="fu">sudo</span> cp libsrc/.libs/libusbip.so.0 /lib/libusbip.so.0</span>
<span id="cb67-6"><a href="#cb67-6" tabindex="-1"></a><span class="fu">sudo</span> apt-get install <span class="at">-y</span> hwdata</span></code></pre></div></li>
<li><p>Copy image (Linux Shell):</p>
<blockquote>
<p><strong>Note:</strong> Please replace <code>&lt;user&gt;</code> with your (Windows) username (e.g. <code>rene</code>)</p>
</blockquote>
<div class="sourceCode" id="cb68"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="bu">cd</span> ~/WSL2-Linux-Kernel</span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a><span class="fu">cp</span> arch/x86/boot/bzImage /mnt/c/Users/<span class="op">&lt;</span>user<span class="op">&gt;</span>/Documents/WSL/canbuntu-bzImage</span></code></pre></div></li>
<li><p>Create <code>.wslconfig</code> in (root of) Windows user directory and store the following text:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="kw">[wsl2]</span></span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a><span class="dt">kernel</span><span class="ot">=</span><span class="st">c:\\users\\&lt;user&gt;\\Documents\\WSL\\canbuntu-bzImage</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> Please replace <code>&lt;user&gt;</code> with your (Windows) username (e.g. <code>rene</code>)</p>
</blockquote></li>
<li><p>Set default distribution (Windows Shell)</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="ex">wsl</span> <span class="at">--setdefault</span> CANbuntu</span></code></pre></div></li>
<li><p>Shutdown and restart WSL (Windows Shell):</p>
<pre class="pwsh"><code>wsl --shutdown
wsl -d CANbuntu --cd &quot;~&quot;</code></pre></li>
<li><p>Change default user of WSL distro (Linux Shell)</p>
<pre><code>sudo nano /etc/wsl.conf</code></pre>
<p>Insert the following text:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="kw">[user]</span></span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a><span class="dt">default</span><span class="ot">=</span><span class="st">&lt;user&gt;</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> Please replace <code>&lt;user&gt;</code> with your (Windows) username (e.g. <code>rene</code>)</p>
</blockquote>
<p>Save the file and exit <code>nano</code>:</p>
<ol style="list-style-type: decimal">
<li><kbd>Ctrl</kbd> + <kbd>O</kbd></li>
<li><kbd>⏎</kbd></li>
<li><kbd>Ctrl</kbd> + <kbd>X</kbd>)</li>
</ol></li>
<li><p>Restart WSL: See step <code>8</code></p></li>
<li><p>Install <code>usbipd</code> (Windows Shell):</p>
<pre class="pwsh"><code>winget install usbipd</code></pre></li>
<li><p>Attach CAN-Adapter to Linux VM (Windows Shell)</p>
<pre class="pwsh"><code>usbipd wsl list
# …
# 5-3    0c72:0012  PCAN-USB FD                      Not attached
# …
usbipd wsl attach -d CANbuntu --busid 5-3
usbipd wsl list
# …
# 5-3    0c72:0012  PCAN-USB FD                      Attached - CANbuntu
# …</code></pre></li>
<li><p>Check for PEAK CAN adapter in Linux (Optional, Linux Shell):</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="fu">dmesg</span> <span class="kw">|</span> <span class="fu">grep</span> peak_usb</span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a><span class="co"># …</span></span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a><span class="co"># peak_usb 1-1:1.0: PEAK-System PCAN-USB FD v1 fw v3.2.0 (1 channels)</span></span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a><span class="co"># …</span></span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a><span class="ex">lsusb</span></span>
<span id="cb76-7"><a href="#cb76-7" tabindex="-1"></a><span class="co"># …</span></span>
<span id="cb76-8"><a href="#cb76-8" tabindex="-1"></a><span class="co"># Bus 001 Device 002: ID 0c72:0012 PEAK System PCAN-USB FD</span></span>
<span id="cb76-9"><a href="#cb76-9" tabindex="-1"></a><span class="co"># …</span></span></code></pre></div></li>
<li><p>Add virtual link for CAN device (Linux Shell)</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="fu">sudo</span> ip link set can0 type can bitrate 1000000</span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a><span class="fu">sudo</span> ip link set can0 up</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>: If the commands above fail with the error message:</p>
<blockquote>
<p>RTNETLINK answers: Connection timed out</p>
</blockquote>
<p>then please disconnect and connect the USB CAN adapter. After that attach it to the Linux VM again (see step <code>12</code>).</p>
</blockquote></li>
<li><p>Install <code>pip</code> (Linux Shell):</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> python3-pip</span></code></pre></div></li>
<li><p>Install ICOc (Linux Shell)</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="bu">cd</span> ~</span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a><span class="fu">mkdir</span> Documents</span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a><span class="bu">cd</span> Documents</span>
<span id="cb79-4"><a href="#cb79-4" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/MyTooliT/ICOc.git</span>
<span id="cb79-5"><a href="#cb79-5" tabindex="-1"></a><span class="bu">cd</span> ICOc</span>
<span id="cb79-6"><a href="#cb79-6" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> pip install <span class="at">--prefix</span><span class="op">=</span><span class="va">$(</span><span class="ex">python3</span> <span class="at">-m</span> site <span class="at">--user-base</span><span class="va">)</span> <span class="at">-e</span> .</span></code></pre></div></li>
<li><p>Run a script to test that everything works as expected (Linux Shell)</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a><span class="ex">icon</span> list</span></code></pre></div>
<p>If the command above fails with the message</p>
<pre><code>Command &#39;icon&#39; not found…</code></pre>
<p>then you might have to logout and login into the WSL session again before you execute <code>icon list</code> again.</p></li>
</ol>
<blockquote>
<p><strong>Notes:</strong></p>
<ul>
<li>You only need to repeat steps</li>
<li><code>12</code>: attach the CAN adapter to the VM in Windows and</li>
<li><code>14</code>: create the link for the CAN device in Linux</li>
</ul>
<p>after you set up everything properly once.</p>
<ul>
<li>Unfortunately <a href="#introduction:section:pcan-driver:linux">configuring the CAN interface automatically</a> does not seem to work (reliably) on WSL yet</li>
</ul>
</blockquote>
<div id="installingusing-simplicity-commander" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Installing/Using Simplicity Commander<a href="#installingusing-simplicity-commander" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Download and unpack <a href="https://community.silabs.com/s/article/simplicity-commander?language=en_US">Simplicity Commander</a> (Linux Shell)</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> unzip</span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/Downloads</span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a><span class="bu">cd</span> ~/Downloads</span>
<span id="cb82-4"><a href="#cb82-4" tabindex="-1"></a><span class="fu">wget</span> https://www.silabs.com/documents/public/software/SimplicityCommander-Linux.zip</span>
<span id="cb82-5"><a href="#cb82-5" tabindex="-1"></a><span class="fu">unzip</span> SimplicityCommander-Linux.zip</span>
<span id="cb82-6"><a href="#cb82-6" tabindex="-1"></a><span class="bu">cd</span> SimplicityCommander-Linux</span>
<span id="cb82-7"><a href="#cb82-7" tabindex="-1"></a><span class="fu">tar</span> xf Commander-cli_linux_x86_64<span class="pp">*</span>.tar.bz</span>
<span id="cb82-8"><a href="#cb82-8" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/Applications</span>
<span id="cb82-9"><a href="#cb82-9" tabindex="-1"></a><span class="fu">mv</span> commander-cli ~/Applications/commander</span>
<span id="cb82-10"><a href="#cb82-10" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> ~/Applications/commander/commander-cli ~/Applications/commander/commander</span>
<span id="cb82-11"><a href="#cb82-11" tabindex="-1"></a><span class="co"># Fix J-Link connection</span></span>
<span id="cb82-12"><a href="#cb82-12" tabindex="-1"></a><span class="co"># https://wiki.segger.com/J-Link_cannot_connect_to_the_CPU</span></span>
<span id="cb82-13"><a href="#cb82-13" tabindex="-1"></a><span class="fu">sudo</span> cp ~/Applications/commander/99-jlink.rules /etc/udev/rules.d/</span></code></pre></div></li>
<li><p>Add <code>commander</code> binary to path (Linux Shell)</p>
<ol style="list-style-type: decimal">
<li><p>Open <code>~/.profile</code> in <code>nano</code>:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="fu">nano</span> ~/.profile</span></code></pre></div></li>
<li><p>Add the following text at the bottom:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-d</span> <span class="st">&quot;</span><span class="va">$HOME</span><span class="st">/Applications/commander&quot;</span> <span class="bu">]</span> <span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a>    <span class="va">PATH</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$HOME</span><span class="st">/Applications/commander:</span><span class="va">$PATH</span><span class="st">&quot;</span></span>
<span id="cb84-3"><a href="#cb84-3" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div></li>
<li><p>Save your changes</p></li>
</ol></li>
<li><p>Restart WSL</p></li>
<li><p>Connect programming adapter to Linux (Windows Shell)</p>
<pre class="pwsh"><code>usbipd wsl list
# …
# 5-4    1366:0105  JLink CDC UART Port (COM3), J-Link driver Not attached
# …
usbipd wsl attach --busid 5-4</code></pre></li>
<li><p>Check if <code>commander</code> JLink connection works without using <code>sudo</code> (Linux Shell)</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a><span class="ex">commander</span> adapter dbgmode OUT <span class="at">--serialno</span> <span class="op">&lt;</span>serialnumber<span class="op">&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2" tabindex="-1"></a><span class="co"># Setting debug mode to OUT...</span></span>
<span id="cb86-3"><a href="#cb86-3" tabindex="-1"></a><span class="co"># DONE</span></span></code></pre></div>
<p>Notes:</p>
<ul>
<li><p>Please replace <code>&lt;serialnumber&gt;</code> with the serial number of your programming board (e.g. <code>440069950</code>):</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="ex">commander</span> adapter dbgmode OUT <span class="at">--serialno</span> 440069950</span></code></pre></div></li>
<li><p>If the command above <a href="https://stackoverflow.com/questions/55313610/importerror-libgl-so-1-cannot-open-shared-object-file-no-such-file-or-directo">fails with the error message</a>:</p>
<pre><code>error while loading shared libraries: libGL.so.1: cannot open shared object file…</code></pre>
<p>then you need to install <code>libgl1</code>:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> libgl1</span></code></pre></div></li>
</ul></li>
</ol>
</div>
<div id="run-tests-in-wsl" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Run Tests in WSL<a href="#run-tests-in-wsl" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Note:</strong> The tests use the command-line <code>xdg-open</code>. For the tests also work on Linux, then you need to install the Python package <a href="https://github.com/cpbotha/xdg-open-wsl"><code>xdg-open-wsl</code></a>:</p>
<pre><code>pip3 install --user git+https://github.com/cpbotha/xdg-open-wsl.git</code></pre>
<ol style="list-style-type: decimal">
<li><p>Start WSL (Windows Shell)</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a><span class="ex">wsl</span> <span class="at">-d</span> CANbuntu <span class="at">--cd</span> <span class="st">&quot;~/Documents/ICOc&quot;</span></span></code></pre></div></li>
<li><p>Connect programming/CAN adapter to Linux (Windows Shell):</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a><span class="va">$jlink_id</span> = usbipd wsl list <span class="kw">|</span> <span class="ex">Select-String</span> JLink <span class="kw">|</span> <span class="ex">%{</span><span class="va">$_</span> <span class="at">-replace</span> <span class="st">&#39;(\d-\d).*&#39;</span>,<span class="st">&#39;$1&#39;</span>}</span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a><span class="va">$can_id</span> = usbipd wsl list <span class="kw">|</span> <span class="ex">Select-String</span> PCAN-USB <span class="kw">|</span> <span class="ex">%{</span><span class="va">$_</span> <span class="at">-replace</span> <span class="st">&#39;(\d-\d).*&#39;</span>,<span class="st">&#39;$1&#39;</span>}</span>
<span id="cb92-3"><a href="#cb92-3" tabindex="-1"></a><span class="ex">usbipd</span> wsl attach <span class="at">-d</span> CANbuntu <span class="at">--busid</span> <span class="va">$jlink_id</span></span>
<span id="cb92-4"><a href="#cb92-4" tabindex="-1"></a><span class="ex">usbipd</span> wsl attach <span class="at">-d</span> CANbuntu <span class="at">--busid</span> <span class="va">$can_id</span></span></code></pre></div></li>
<li><p>Configure CAN interface (Linux Shell):</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a><span class="fu">sudo</span> ip link set can0 type can bitrate 1000000</span>
<span id="cb93-2"><a href="#cb93-2" tabindex="-1"></a><span class="fu">sudo</span> ip link set can0 up</span></code></pre></div></li>
<li><p>Run tests (Linux Shell):</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a><span class="fu">make</span> run</span></code></pre></div></li>
</ol>

</div>
</div>
</div>
<div id="containerization" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Containerization<a href="#containerization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="docker-on-linux" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Docker on Linux<a href="#docker-on-linux" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The text below shows how you can use (code of) the new Network class in a Docker container on a <strong>Linux host</strong>. The description on how to move the interface of the Docker container is an adaption of an <a href="https://chemnitzer.linux-tage.de/2021/de/programm/beitrag/210">article/video from the “Chemnitzer Linux-Tage”</a>.</p>
<div id="creating-a-docker-image" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Creating a Docker Image<a href="#creating-a-docker-image" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To create a Docker image that contains ICOc just install the package with <code>pip</code> inside your <code>Dockerfile</code>. We recommend that you use a virtual environment to install the package. For an example, please take a look at the <a href="Docker/Dockerfile"><code>Dockerfile</code> in the folder Docker</a>.</p>
</div>
<div id="building-the-docker-image" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Building the Docker Image<a href="#building-the-docker-image" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you do not want to create a <code>Dockerfile</code> yourself, you can build an image based on our Docker example file:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> mytoolit/icoc <span class="at">-f</span> Docker/Dockerfile .</span></code></pre></div>
</div>
<div id="using-icoc-in-the-docker-container" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Using ICOc in the Docker Container<a href="#using-icoc-in-the-docker-container" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Run the container <strong>(Terminal 1)</strong></p>
<ol style="list-style-type: decimal">
<li><p>Open a new terminal window</p></li>
<li><p>Open a shell in the Docker container</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="at">--name</span> icoc mytoolit/icoc</span></code></pre></div></li>
</ol></li>
<li><p>Move the CAN interface into the network space of the Docker container <strong>(Terminal 2)</strong></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a><span class="bu">export</span> <span class="va">DOCKERPID</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="ex">docker</span> inspect <span class="at">-f</span> <span class="st">&#39;{{ .State.Pid }}&#39;</span> icoc<span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb97-2"><a href="#cb97-2" tabindex="-1"></a><span class="fu">sudo</span> ip link set can0 netns <span class="st">&quot;</span><span class="va">$DOCKERPID</span><span class="st">&quot;</span></span>
<span id="cb97-3"><a href="#cb97-3" tabindex="-1"></a><span class="fu">sudo</span> nsenter <span class="at">-t</span> <span class="st">&quot;</span><span class="va">$DOCKERPID</span><span class="st">&quot;</span> <span class="at">-n</span> ip link set can0 type can bitrate 1000000</span>
<span id="cb97-4"><a href="#cb97-4" tabindex="-1"></a><span class="fu">sudo</span> nsenter <span class="at">-t</span> <span class="st">&quot;</span><span class="va">$DOCKERPID</span><span class="st">&quot;</span> <span class="at">-n</span> ip link set can0 up</span></code></pre></div>
<p><strong>Note:</strong> Alternatively you can also add the option <code>--network host</code> to the Docker command from step 1. Please check out the <a href="https://docs.docker.com/engine/network/drivers/host/">Docker documentation</a> to learn more about the consequences of using this option.</p></li>
<li><p>Run a test command in Docker container <strong>(Terminal 1)</strong> e.g.:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a><span class="ex">icon</span> list</span></code></pre></div></li>
</ol>

</div>
</div>
</div>
<div id="scripts:section:scripts" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Scripts<a href="#scripts:section:scripts" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>After you installed the ICOc package various helper scripts are available:</p>
<ul>
<li><a href="#mac-address-conversion"><code>convert-base64-mac</code></a>: Utility to convert a Base64 encoded 8 character text into a Bluetooth MAC address</li>
<li><a href="#mac-address-conversion"><code>convert-mac-base64</code></a>: Convert Bluetooth MAC address into a (Base64) encoded 8 character string</li>
<li><a href="#eeprom-check"><code>check-eeprom</code></a>: Write a byte value into the cells of an EEPROM page an check how many of the values are read incorrectly after an reset</li>
<li><a href="#section:scripts:icoc"><code>icoc</code></a>: Controller and measurement software for the ICOtronic system</li>
<li><a href="#section:scripts:icon"><code>icon</code></a>: Controller software for the ICOtronic system</li>
<li><a href="#section:scripts:test-smh"><code>test-smh</code></a>: Test code for the SMH</li>
<li><a href="#section:scripts:test-sth"><code>test-sth</code></a>: Test code for the STH/SHA</li>
<li><a href="#section:scripts:test-stu"><code>test-stu</code></a>: Test code for the STU</li>
</ul>
<div id="eeprom-check" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> EEPROM Check<a href="#eeprom-check" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The script <code>check-eeprom</code> connects to an STH using its MAC address. Afterwards it writes a given byte value (default: <code>10</code>) into all the cells of an EEPROM page. It then resets the STH, connects again and shows the amount of incorrect EEPROM bytes. It repeats the last steps 5 times before it prints all values in the EEPROM page.</p>
<p>The command below shows how to execute the EEPROM check for the STH with MAC address <code>08:6b:d7:01:de:81</code>:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a><span class="ex">check-eeprom</span> 08:6b:d7:01:de:81</span></code></pre></div>
<p>You can specify the value that should be written into the EEPROM cells using the option <code>--value</code>:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a><span class="ex">check-eeprom</span> 08:6b:d7:01:de:81 <span class="at">--value</span> 42</span></code></pre></div>
</div>
<div id="section:scripts:icoc" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> ICOc<a href="#section:scripts:icoc" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The command <code>icoc</code> calls <code>ui.py</code>. All command line arguments to the script will be directly forwarded to <code>ui.py</code>. For example, to read acceleration data for 10 seconds from the STH with the (Bluetooth advertisement) name <code>CGvXAd6B</code>, you can use the following command:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb101-1"><a href="#cb101-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-n</span> CGvXAd6B <span class="at">-r</span> 10</span></code></pre></div>
</div>
<div id="section:scripts:icon" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> ICOn<a href="#section:scripts:icon" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The command ICOn uses the <a href="../mytoolit/can/network.py">new <code>Network</code> class</a> (based on <a href="https://python-can.readthedocs.io"><code>python-can</code></a>) to communicate with the ICOtronic system. Compared to ICOc the script currently offers very limited functionality. However, in the future most of the functionality from ICOc should be integrated into this new command line tool. A big advantage of ICOn compared to ICOc is that the command <strong>also works on Linux and macOS</strong>. For more information, please take a look <a href="#icon-cli-tool">here</a>.</p>
</div>
<div id="mac-address-conversion" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> MAC Address Conversion<a href="#mac-address-conversion" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The utility <code>convert-mac-base64</code> returns the Base64 encoded version of a MAC address. We use the encoded addresses as unique Bluetooth advertisement name for the STH (or SHA). Unfortunately we can not use the MAC address directly because the maximum length of the name is limited to 8 characters. To decode the Base64 name back into a Bluetooth address you can use the script <code>convert-base64-mac</code>.</p>
<div id="examples" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Examples<a href="#examples" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb102"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a><span class="co"># Convert a MAC address into an 8 character name</span></span>
<span id="cb102-2"><a href="#cb102-2" tabindex="-1"></a><span class="ex">convert-mac-base64</span> 08:6b:d7:01:de:81</span>
<span id="cb102-3"><a href="#cb102-3" tabindex="-1"></a><span class="co">#&gt; CGvXAd6B</span></span>
<span id="cb102-4"><a href="#cb102-4" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" tabindex="-1"></a><span class="co"># Convert the Base64 encoded name back into a MAC address</span></span>
<span id="cb102-6"><a href="#cb102-6" tabindex="-1"></a><span class="ex">convert-base64-mac</span> CGvXAd6B</span>
<span id="cb102-7"><a href="#cb102-7" tabindex="-1"></a><span class="co">#&gt; 08:6b:d7:01:de:81</span></span></code></pre></div>
</div>
</div>
<div id="section:scripts:test-sth" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Test-STH<a href="#section:scripts:test-sth" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The command <code>test-sth</code> is a command that executes the tests for the STH (<a href="../mytoolit/test/production/sth.py"><code>sth.py</code></a>). All command line arguments of the wrapper will be forwarded to <a href="../mytoolit/test/production/sth.py"><code>sth.py</code></a>.</p>
</div>
<div id="section:scripts:test-stu" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Test-STU<a href="#section:scripts:test-stu" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The command <code>test-stu</code> is a wrapper that executes the tests for the STU (<a href="../mytoolit/test/production/stu.py"><code>stu.py</code></a>). All command line arguments of the wrapper will be forwarded to <a href="../mytoolit/test/production/stu.py"><code>stu.py</code></a>.</p>
</div>
<div id="section:scripts:test-smh" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Test-SMH<a href="#section:scripts:test-smh" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The command <code>test-smh</code> is a wrapper that executes the tests for the SMH (<a href="../mytoolit/test/production/smh.py"><code>smh.py</code></a>). All command line arguments of the wrapper will be forwarded to <a href="../mytoolit/test/production/smh.py"><code>smh.py</code></a>.</p>

</div>
</div>
<div id="development" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Development<a href="#development" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="install-1" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Install<a href="#install-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You can use the instructions below, if you want to work on the code of ICOc, i.e. add additional features or fix bugs.</p>
<ol style="list-style-type: decimal">
<li><p>Clone <a href="https://github.com/MyTooliT/ICOc">the repository</a> to a directory of your choice. You can either use the <a href="https://git-scm.com/downloads">command line tool <code>git</code></a>:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/MyTooliT/ICOc.git</span></code></pre></div>
<p>or one of the many available <a href="https://git-scm.com/downloads/guis">graphical user interfaces for Git</a> to do that.</p></li>
<li><p>Install ICOc in “developer mode”</p>
<ol style="list-style-type: decimal">
<li><p>Change your working directory to the (root) directory of the cloned repository</p></li>
<li><p>Install ICOc:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-e</span> .<span class="pp">[</span><span class="ss">dev,test</span><span class="pp">]</span></span></code></pre></div>
<blockquote>
<p><strong>Notes:</strong></p>
<ul>
<li>The command above will install the repository in “editable mode” (<code>-e</code>), meaning that a command such as <code>icoc</code> will use the current code inside the repository.</li>
<li>The command also installs
<ul>
<li>development (<code>dev</code>) and</li>
<li>test (<code>test</code>) dependencies</li>
</ul></li>
</ul>
</blockquote></li>
</ol></li>
<li><p>Install other required tools (for tests)</p>
<ul>
<li><p><code>hdf5</code>: For the command line tool <code>h5dump</code> (Linux/macOS). You can install hdf5 via <a href="https://brew.sh">Homebrew</a>:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a><span class="ex">brew</span> install hdf5</span></code></pre></div></li>
</ul></li>
</ol>
</div>
<div id="style" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Style<a href="#style" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Please use the guidelines from <a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a>. For code formatting we currently use <a href="https://github.com/psf/black">Black</a>, which should format code according to PEP 8 by default.</p>
<p>To format the whole code base you can use the following command in the root of the repository:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb106-1"><a href="#cb106-1" tabindex="-1"></a><span class="ex">black</span> .</span></code></pre></div>
<p>For development we recommend that you use a tool or plugin that reformats your code with Black every time you save. This way we can ensure that we use a consistent style for the whole code base.</p>
</div>
<div id="tests" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Tests<a href="#tests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following text describes some of the measures we should take to keep the software stable.</p>
<p>Please only push your changes to the <code>master</code> branch, if you think there are no new bugs or regressions. The <code>master</code> branch <strong>should always contain a working version of the software</strong>. Please <strong>always run</strong></p>
<ul>
<li>the <strong>automatic test</strong> (<code>make run</code>) for <strong>every supported OS</strong> (Linux, macOS, Windows) and</li>
<li>the <strong>manual tests</strong> on Windows</li>
</ul>
<p>before you push to the <code>master</code> branch.</p>
<div id="code-checks" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Code Checks<a href="#code-checks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="flake8" class="section level4 hasAnchor" number="7.3.1.1">
<h4><span class="header-section-number">7.3.1.1</span> Flake8<a href="#flake8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We check the code with <a href="https://flake8.pycqa.org">flake8</a>:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a><span class="ex">pip</span> install flake8</span></code></pre></div>
<p>Please use the following command in the root of the repository to make sure you did not add any code that introduces warnings:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb108-1"><a href="#cb108-1" tabindex="-1"></a><span class="ex">flake8</span></span></code></pre></div>
</div>
<div id="mypy" class="section level4 hasAnchor" number="7.3.1.2">
<h4><span class="header-section-number">7.3.1.2</span> mypy<a href="#mypy" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To check the type hint in the code base we use the static code checker <a href="https://mypy.readthedocs.io">mypy</a>:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a><span class="ex">pip</span> install mypy</span></code></pre></div>
<p>Please use the following command in the root of the repository to check the code base for type problems:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb110-1"><a href="#cb110-1" tabindex="-1"></a><span class="ex">mypy</span> mytoolit</span></code></pre></div>
</div>
<div id="pylint" class="section level4 hasAnchor" number="7.3.1.3">
<h4><span class="header-section-number">7.3.1.3</span> Pylint<a href="#pylint" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We currently use <a href="https://github.com/PyCQA/pylint">Pylint</a> to check the code:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a><span class="ex">pylint</span> mytoolit</span></code></pre></div>
</div>
</div>
<div id="automatic-tests" class="section level3 hasAnchor" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Automatic Tests<a href="#automatic-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="requirements-1" class="section level4 hasAnchor" number="7.3.2.1">
<h4><span class="header-section-number">7.3.2.1</span> Requirements<a href="#requirements-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Please install the <a href="https://docs.pytest.org">pytest testing module</a>:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb112-1"><a href="#cb112-1" tabindex="-1"></a><span class="ex">pip</span> install pytest</span></code></pre></div>
<div id="usage" class="section level5 hasAnchor" number="7.3.2.1.1">
<h5><span class="header-section-number">7.3.2.1.1</span> Usage<a href="#usage" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Please run the following command in the root of the repository:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a><span class="ex">pytest</span> <span class="at">-v</span></span></code></pre></div>
<p>and make sure that it reports no test failures.</p>
</div>
</div>
</div>
<div id="manual-tests" class="section level3 hasAnchor" number="7.3.3">
<h3><span class="header-section-number">7.3.3</span> Manual Tests<a href="#manual-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="icoc-1" class="section level4 hasAnchor" number="7.3.3.1">
<h4><span class="header-section-number">7.3.3.1</span> ICOc<a href="#icoc-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Call the command <code>icoc</code>.</li>
<li>Connect to a working STH (Enter the number and press <kbd>⏎</kbd>)</li>
<li>Start the data acquisition (<kbd>s</kbd>)</li>
<li>After some time a window displaying the current acceleration of the STH (or SHA) should show up</li>
<li>Shake the STH</li>
<li>Make sure the window shows the increased acceleration</li>
<li>Close the window</li>
<li>The programm should now exit, without any error messages</li>
</ol>
</div>
<div id="sth-test" class="section level4 hasAnchor" number="7.3.3.2">
<h4><span class="header-section-number">7.3.3.2</span> STH Test<a href="#sth-test" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Call the command <code>test-sth</code> for a working STH</li>
<li>Wait for the command execution</li>
<li>Check that the command shows no error messages</li>
<li>Open the PDF report (<code>STH Test.pdf</code>) in the repository root and make sure that it includes the correct test data</li>
</ol>
</div>
<div id="development:section:stu-test" class="section level4 hasAnchor" number="7.3.3.3">
<h4><span class="header-section-number">7.3.3.3</span> STU Test<a href="#development:section:stu-test" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Call the command <code>test-stu</code> (or <code>test-stu -k eeprom -k connection</code> when you want to skip the flash test) for a working STU</li>
<li>Wait for the command execution</li>
<li>Check that the command shows no error messages</li>
<li>Open the PDF report (<code>STU Test.pdf</code>) in the repository root and make sure that it includes the correct test data</li>
</ol>
<div id="development:section:extended-tests" class="section level5 hasAnchor" number="7.3.3.3.1">
<h5><span class="header-section-number">7.3.3.3.1</span> Extended Tests<a href="#development:section:extended-tests" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The text below specifies extended manual test that should be executed before we <a href="#development:section:release">release a new version of ICOc</a>. Please note that the tests assume that you use more or less the <a href="https://github.com/MyTooliT/ICOc/blob/master/mytoolit/config/config.yaml">default configuration values</a>.</p>
<div id="check-command-line-interface" class="section level6 hasAnchor" number="7.3.3.3.1.1">
<h6><span class="header-section-number">7.3.3.3.1.1</span> Check Command Line Interface<a href="#check-command-line-interface" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<ol style="list-style-type: decimal">
<li><p>Open your favorite terminal application and change your working directory to the root of the repository</p></li>
<li><p>Remove HDF5 files from the repository:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb114-1"><a href="#cb114-1" tabindex="-1"></a><span class="fu">rm</span> <span class="pp">*</span>.hdf5</span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> You can ignore errors about “no matches for wildcard” on Linux and macOS. This message just tells you that there is no file with the extension <code>hdf5</code> in the current directory.</p>
</blockquote></li>
<li><p>Check that no HDF5 files exist in the repository. The following command should not produce any output:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>.hdf5</span></code></pre></div></li>
<li><p>Give your test STH the <a href="#tutorials:section:sth-renaming">name</a> “Test-STH”</p></li>
<li><p>Measure data for 10 seconds using the following command:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb116-1"><a href="#cb116-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-n</span> <span class="st">&#39;Test-STH&#39;</span> <span class="at">-r</span> 10</span></code></pre></div></li>
<li><p>Check that the repo now contains a HDF5 (<code>*.hdf5</code>) file</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>.hdf5</span></code></pre></div></li>
<li><p>Open the file in <a href="#measurement-data">HDFView</a></p></li>
<li><p>Check that the table <code>acceleration</code> contains about 95 000 values</p></li>
<li><p>Check that the table contains three columns</p></li>
<li><p>Check that the meta attributes <code>Sensor_Range</code> and <code>Start_Time</code> exist</p></li>
<li><p>Check that <code>Sensor_Range</code> contains the correct maximum acceleration values for “Test-STH”</p></li>
<li><p>Check that <code>Start_Time</code> contains (roughly) the date and time when you executed the command from step 5</p></li>
<li><p>Check that ICOc handles the following incorrect program calls. The program should <strong>not crash</strong> and print a (helpful) <strong>error description</strong> (not a stak trace) before it exits.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb118-1"><a href="#cb118-1" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-b</span> <span class="st">&#39;12-12-12-12-12&#39;</span></span>
<span id="cb118-2"><a href="#cb118-2" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-n</span> <span class="st">&#39;TooooLong&#39;</span></span>
<span id="cb118-3"><a href="#cb118-3" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-s</span> 1</span>
<span id="cb118-4"><a href="#cb118-4" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-a</span> 257</span>
<span id="cb118-5"><a href="#cb118-5" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-o</span> <span class="at">-1</span></span>
<span id="cb118-6"><a href="#cb118-6" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-1</span> <span class="st">&#39; -1&#39;</span></span>
<span id="cb118-7"><a href="#cb118-7" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-2</span> 256</span>
<span id="cb118-8"><a href="#cb118-8" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-3</span> nine</span>
<span id="cb118-9"><a href="#cb118-9" tabindex="-1"></a><span class="ex">icoc</span> <span class="at">-1</span> 0 <span class="at">-2</span> 0 <span class="at">-3</span> 0 <span class="at">-n</span> Test-STH</span></code></pre></div></li>
</ol>
</div>
<div id="check-user-interface" class="section level6 hasAnchor" number="7.3.3.3.1.2">
<h6><span class="header-section-number">7.3.3.3.1.2</span> Check User Interface<a href="#check-user-interface" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<ol style="list-style-type: decimal">
<li><p>Repeat steps 1. – 4. from the test above</p></li>
<li><p>Open ICOc using the following command:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a><span class="ex">icoc</span></span></code></pre></div></li>
<li><p>The main menu of ICOc should show up</p></li>
<li><p>Try to connect to a non-existent STH</p>
<ol style="list-style-type: decimal">
<li>Enter the text “1234”</li>
<li>Press <kbd>⏎</kbd></li>
<li>ICOc should ignore the incorrect input and just display the main window</li>
</ol></li>
<li><p>Change the output file name to “Test”</p>
<ol style="list-style-type: decimal">
<li>Press <kbd>f</kbd></li>
<li>Remove the default name and enter the text “Test”</li>
<li>Press <kbd>⏎</kbd></li>
<li>After two seconds ICOc should show the main menu again</li>
</ol></li>
<li><p>Connect to your test STH/SHA</p>
<ol style="list-style-type: decimal">
<li>Enter the number besides “Test-STH”: Usually this will be the number “1”</li>
<li>Press <kbd>⏎</kbd></li>
<li>You should now be in the STH menu</li>
</ol></li>
<li><p>Change the runtime to 20 seconds</p>
<ol start="2" style="list-style-type: decimal">
<li>Press <kbd>r</kbd></li>
<li>Enter the text “hello”</li>
<li>The last step should not have changed the default runtime of “0”</li>
<li>Remove the default runtime (press <kbd>⌫</kbd>)</li>
<li>Enter the text “20”</li>
<li>Press <kbd>⏎</kbd></li>
</ol></li>
<li><p>Check that entering an empty channel configuration is not possible</p>
<ol style="list-style-type: decimal">
<li>Press <kbd>p</kbd></li>
<li>Remove the default axis config for the first measurement channel (press <kbd>⌫</kbd> at least one time)</li>
<li>Disable the first measurement channel
<ol style="list-style-type: decimal">
<li>Press <kbd>0</kbd></li>
<li>Press <kbd>⏎</kbd></li>
</ol></li>
<li>Disable the second measurement channel (<kbd>⏎</kbd>)</li>
<li>Disable the third measurement channel (<kbd>⏎</kbd>)</li>
<li>ICOc should show an error message for two seconds and switch back to the STH UI</li>
</ol></li>
<li><p>Enable the first and second measurement channel</p>
<ol style="list-style-type: decimal">
<li>Press <kbd>p</kbd></li>
<li>Remove the default axis config for the first measurement channel (press <kbd>⌫</kbd> at least one time)</li>
<li>Enter the characters “23456789ab”</li>
<li>The last step should not have changed the empty input value</li>
<li>Enable the first measurement channel:
<ol style="list-style-type: decimal">
<li>Press <kbd>1</kbd></li>
<li>Press <kbd>⏎</kbd></li>
</ol></li>
<li>Enable the second measurement channel:
<ol style="list-style-type: decimal">
<li>Press <kbd>⌫</kbd></li>
<li>Press <kbd>1</kbd></li>
<li>Press <kbd>⏎</kbd></li>
</ol></li>
<li>Disable the third measurement channel:
<ol style="list-style-type: decimal">
<li>Press <kbd>⌫</kbd></li>
<li>Press <kbd>0</kbd></li>
<li>Press <kbd>⏎</kbd></li>
</ol></li>
</ol></li>
<li><p>Start the data acquisition</p>
<ol style="list-style-type: decimal">
<li>Press <kbd>s</kbd></li>
<li>Shake the STH</li>
<li>Make sure that shaking the STH changes (at least) the displayed value for the first measurement channel</li>
<li>Wait until the measurement took place</li>
</ol></li>
<li><p>Check the output file</p>
<ol style="list-style-type: decimal">
<li>Check that the HDF5 output file exists: The filename should start with the characters “Test” followed by a timestamp and the extension “.hdf5”</li>
<li>Open the HDF measurement file in <a href="#measurement-data">HDFView</a></li>
<li>Check that the table contains four columns</li>
<li>One of the columns should have the name <code>x</code></li>
<li>Another column should have the name <code>y</code></li>
</ol></li>
</ol>
</div>
</div>
</div>
</div>
<div id="combined-checks-tests" class="section level3 hasAnchor" number="7.3.4">
<h3><span class="header-section-number">7.3.4</span> Combined Checks &amp; Tests<a href="#combined-checks-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While you need to execute some test for ICOc manually, other tests and checks can be automated.</p>
<blockquote>
<p><strong>Note:</strong> For the text below we assume that you installed <a href="https://en.wikipedia.org/wiki/Make_(software)#Makefile"><code>make</code></a> on your machine.</p>
</blockquote>
<p>To run all checks, the STH test and the STU test use the following <code>make</code> command:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb120-1"><a href="#cb120-1" tabindex="-1"></a><span class="fu">make</span> run</span></code></pre></div>
<p>Afterwards make sure there were no (unexpected) errors in the output of the STH and STU test.</p>
</div>
</div>
<div id="development:section:release" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Release<a href="#development:section:release" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Check that the <a href="https://github.com/MyTooliT/ICOc/actions"><strong>CI jobs</strong> for the <code>master</code> branch finish successfully</a></p></li>
<li><p>Check that the <strong>checks and tests</strong> run without any problems on <strong>Linux</strong>, <strong>macOS</strong> and <strong>Windows</strong></p>
<ol style="list-style-type: decimal">
<li><p>Set the value of <code>sth</code> → <code>status</code> in the <a href="#changing-configuration-values">configuration</a> to <code>Epoxied</code></p></li>
<li><p>Execute the command:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a><span class="fu">make</span> run</span></code></pre></div>
<p>in the root of the repository</p></li>
</ol></li>
<li><p>Check that the <strong>firmware flash</strong> works in Windows</p>
<ul>
<li><p>Execute <code>test-sth</code></p>
<ol style="list-style-type: decimal">
<li>once with <code>sth</code> → <code>status</code> set to <code>Epoxied</code>, and</li>
<li>once set to <code>Bare PCB</code></li>
</ol>
<p>in the <a href="#changing-configuration-values">configuration</a>. To make sure, that the STU flash test also works, please use both STU test commands described in the section <a href="#development:section:stu-test">“STU Test”</a>.</p>
<p>If you follow the steps above you make sure that the <strong>flash tests work</strong> for both STU and STH, and there are <strong>no unintentional consequences of (not) flashing the chip</strong> before you run the other parts of the test suite.</p></li>
</ul></li>
<li><p>Execute the <strong><a href="#development:section:extended-tests">extended manual tests</a></strong> in Windows and check that everything works as expected</p></li>
<li><p>Create a new release <a href="https://github.com/MyTooliT/ICOc/releases/new">here</a></p>
<ol style="list-style-type: decimal">
<li><p>Open the <a href="Releases">release notes</a> for the latest version</p></li>
<li><p>Replace links with a permanent version:</p>
<p>For example instead of</p>
<ul>
<li><code>../../something.txt</code> use</li>
<li><code>https://github.com/MyTooliT/ICOc/blob/REVISION/something.txt</code>,</li>
</ul>
<p>where <code>REVISION</code> is the latest version of the master branch (e.g. <code>8568893f</code> for version <code>1.0.5</code>)</p></li>
<li><p>Commit your changes</p></li>
<li><p>Copy the release notes</p></li>
<li><p>Paste them into the main text of the release web page</p></li>
<li><p>Decrease the header level of each section by two</p></li>
<li><p>Remove the very first header</p></li>
<li><p>Check that all links work correctly</p></li>
</ol></li>
<li><p>Change the <a href="../mytoolit/__init__.py"><code>__version__</code></a> number inside the <a href="../mytoolit"><code>mytoolit</code></a> package</p></li>
<li><p>Push the latest two commits</p></li>
<li><p>Update the <a href="https://pypi.org/project/icoc">official ICOc Python package on PyPI</a>:</p>
<ol style="list-style-type: decimal">
<li><p>Install <code>build</code> and <code>twine</code>:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb122-1"><a href="#cb122-1" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--upgrade</span> build twine</span></code></pre></div></li>
<li><p>Build the package (in the root directory of the repository):</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> build</span></code></pre></div></li>
<li><p>Check the package:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb124-1"><a href="#cb124-1" tabindex="-1"></a><span class="ex">twine</span> check dist/<span class="pp">*</span></span></code></pre></div>
<p>The output of the command above should print the text <code>PASSED</code> twice.</p></li>
<li><p>Upload the package to PyPI:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb125-1"><a href="#cb125-1" tabindex="-1"></a><span class="ex">twine</span> upload dist/<span class="pp">*</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> For the command above to work you need an API token, which you can create after <a href="https://pypi.org/account/login/">logging into the PyPI <code>mytoolit</code> account</a>. If you need access to the account, please contact <a href="https://github.com/sanssecours">René Schwaiger</a>.</p>
</blockquote></li>
</ol></li>
<li><p>Insert the version number (e.g. <code>1.0.5</code>) into the tag field</p></li>
<li><p>For the release title use “Version VERSION”, where <code>VERSION</code> specifies the version number (e.g. “Version 1.0.5”)</p></li>
<li><p>Click on “Publish Release”</p></li>
<li><p>Close the <a href="https://github.com/MyTooliT/ICOc/milestones">milestone</a> for the latest release number</p></li>
<li><p>Create a new <a href="https://github.com/MyTooliT/ICOc/milestones">milestone</a> for the next release</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Documentation.pdf", "Documentation.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none",
"scroll_highlight": true
},
"toc_depth": 3
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
